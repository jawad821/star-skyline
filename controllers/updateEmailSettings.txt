

// Update SMTP Email Settings
exports.updateEmailSettings = async (req, res) => {
    try {
        const { smtp_host, smtp_port, smtp_user, smtp_password, smtp_from, smtp_secure } = req.body;
        const userId = req.user?.id || req.user?.email || 'admin';

        const updates = [
            { key: 'smtp_host', value: smtp_host },
            { key: 'smtp_port', value: smtp_port },
            { key: 'smtp_user', value: smtp_user },
            { key: 'smtp_password', value: smtp_password },
            { key: 'smtp_from', value: smtp_from },
            { key: 'smtp_secure', value: smtp_secure }
        ];

        for (const update of updates) {
            if (update.value !== undefined && update.value !== null) {
                await query(`
          INSERT INTO settings (setting_key, setting_value, category, updated_by, updated_at)
          VALUES ($1, $2, 'email', $3, NOW())
          ON CONFLICT (setting_key) 
          DO UPDATE SET setting_value = $2, updated_by = $3, updated_at = NOW()
        `, [update.key, update.value, userId]);
            }
        }

        res.json({ success: true, message: 'SMTP settings updated successfully' });
    } catch (error) {
        console.error('Error updating SMTP settings:', error);
        res.status(500).json({ success: false, message: 'Error updating SMTP settings' });
    }
};
