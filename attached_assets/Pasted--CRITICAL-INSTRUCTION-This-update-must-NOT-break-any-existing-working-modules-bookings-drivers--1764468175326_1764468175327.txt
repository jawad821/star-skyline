‚ö†Ô∏è CRITICAL INSTRUCTION:
This update must NOT break any existing working modules (bookings, drivers, vehicles, AI booking, manual booking, notifications, assignments, dashboards, vendor logic).
‚úÖ Only the Fare Rule calculation logic & admin-editable fare rules will be updated.
‚úÖ No unrelated refactoring, no API response changes, no frontend structural changes.

üéØ OBJECTIVE

Implement new slab-based fare logic for all vehicle categories using the client-approved ‚Äúfull-distance after threshold‚Äù formula.

Fare rules must be:

Dynamic (admin editable)

Applied only to new bookings

Stored in DB

Used by:

AI auto-booking

Manual admin booking

Fare preview before booking confirmation

‚úÖ FINAL CLIENT-APPROVED FARE LOGIC (IMPORTANT)

‚ö†Ô∏è This is NOT standard taxi logic. This is client‚Äôs explicit rule:

If distance <= included_km:
    fare = base_fare
Else:
    fare = base_fare + (distance √ó per_km)


‚úÖ Once distance crosses the included KM, the FULL total distance is multiplied by per_km, not just the extra KM.

‚úÖ VEHICLE CATEGORIES & MODELS (LOCKED)
1Ô∏è‚É£ Classic

Model: BYD Han

Base Fare: AED 95

Included KM: 20

Per KM: AED 1

2Ô∏è‚É£ Executive

Models:

E Class

Lexus ES 300H

Tesla Model Y

Tesla Model 3

Base: AED 105

Included: 20 KM

Per KM: AED 1

3Ô∏è‚É£ Urban SUV

Models:

BYD Song

Highlander

Base: AED 108

Included: 20 KM

Per KM: AED 1

4Ô∏è‚É£ Elite Van

Model: V Class

Base: AED 165

Included: 20 KM

Per KM: AED 2

5Ô∏è‚É£ Luxury SUV

Models:

GMC Yukon

Cadillac Escalade

Base: AED 170

Included: 20 KM

Per KM: AED 1.8

6Ô∏è‚É£ First Class

Models:

S Class

Audi A8

BMW 7 Series

Base: AED 450

Included: 40 KM

Per KM: AED 1.75

7Ô∏è‚É£ Mini Bus

Model: Sprinter

Base: AED 825

Included: 50 KM

Per KM: AED 7.5

‚úÖ DATABASE REQUIREMENT

Create or update a table like:

fare_rules
- id
- vehicle_category
- base_fare
- included_km
- per_km_rate
- is_active
- created_at


‚úÖ Existing bookings must NOT be recalculated
‚úÖ Only new bookings should use updated fare logic

‚úÖ API LOGIC (STRICT)

Centralize fare calculation in ONE shared helper/service used by:

AI Booking API (Port 5000)

Manual Booking API (Port 8000)

Exact Formula to Use (NO VARIATION ALLOWED):

if distance <= included_km:
    fare = base_fare
else:
    fare = base_fare + (distance * per_km_rate)


‚úÖ Decimal support required
‚úÖ Round final fare to 2 decimals only
‚úÖ Return calculated fare before booking save

‚úÖ ADMIN PANEL (SAFE UPDATE ONLY)

Admin must be able to:

View all fare rules

Edit:

Base fare

Included KM

Per KM rate

Toggle active/inactive

‚ö†Ô∏è Editing a rule must:

Affect only future bookings

Not modify old booking fares

‚úÖ DO NOT TOUCH / DO NOT BREAK

‚ùå Booking assignment logic
‚ùå Driver‚ÄìVehicle tagging
‚ùå Vendor module
‚ùå Notification system
‚ùå Dashboards
‚ùå Auto-assignment
‚ùå Status flows (pending, assigned, in_progress, completed)

This task is PURELY fare-rule calculation & admin configurability.

‚úÖ REQUIRED TEST CASES (MANDATORY)

Developer must test:

Category	KM	Expected Logic
Classic	15	Fare = 95
Classic	21	Fare = 95 + 21 √ó 1
Executive	25	105 + 25 √ó 1
Urban SUV	30	108 + 30 √ó 1
Elite Van	22	165 + 22 √ó 2
Luxury SUV	28	170 + 28 √ó 1.8
First Class	41	450 + 41 √ó 1.75
Mini Bus	51	825 + 51 √ó 7.5

Results must log correctly in DB and appear correctly in booking UI.

‚úÖ DELIVERY REQUIREMENTS

No breaking changes

No API response shape changes

No frontend redesign

Only:

Fare Rules DB

Fare Calculation Logic

Admin Edit Panel

‚úÖ Confirm once deployed:

DB migration applied

APIs tested

3 sample live test bookings created

‚úÖ FINAL SAFETY LINE (MANDATORY ACKNOWLEDGEMENT)

Developer must confirm:

‚ÄúFare logic updated as per full-distance-after-threshold rule, existing system untouched, all prior features stable.‚Äù