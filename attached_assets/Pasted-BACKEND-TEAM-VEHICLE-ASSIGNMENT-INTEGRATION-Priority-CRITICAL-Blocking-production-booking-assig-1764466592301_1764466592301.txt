BACKEND TEAM: VEHICLE ASSIGNMENT INTEGRATION
Priority: CRITICAL - Blocking production booking assignments
From: Bareerah AI (WhatsApp Booking Assistant)
Date: Nov 30, 2025
Status: üî¥ FAILING - Backend schema incomplete

üìä CURRENT STATE
What Bareerah IS Sending (‚úÖ Working)
When a customer confirms a booking, Bareerah sends this payload to /api/bookings/create-manual:

{
  "customer_name": "Test Bareerah",
  "customer_phone": "+971501234567",
  "customer_email": "test@email.com",
  "pickup_location": "Dubai Airport",
  "dropoff_location": "Burj Khalifa",
  "booking_type": "point_to_point",
  "vehicle_type": "SEDAN",
  "distance_km": 30,
  "passengers_count": 2,
  "luggage_count": 1,
  
  ‚úÖ "vehicle_model": "Toyota Camry",        ‚Üê WE SEND THIS
  ‚úÖ "assigned_vehicle_id": "VEH001"         ‚Üê WE SEND THIS
}

What Backend Shows (‚ùå Problem)
Booking dashboard displays:

Vehicle Model: N/A           ‚Üê Should be "Toyota Camry"
Assigned Vehicle: None       ‚Üê Should be "VEH001"
Driver: Not assigned         ‚Üê Should have vehicle + driver info

üî¥ THE PROBLEM
Root Cause: Backend bookings table schema missing two critical columns

Missing Columns in bookings Table:
Column	Type	Required	Purpose
vehicle_model	VARCHAR(100)	‚úÖ YES	Car name (e.g., "Toyota Camry", "Lexus ES350")
assigned_vehicle_id	VARCHAR(50)	‚úÖ YES	Vehicle ID (e.g., "VEH001", "VEH007")
Current Schema (‚ùå Incomplete)
‚úÖ id (UUID)
‚úÖ customer_name
‚úÖ customer_phone
‚úÖ pickup_location
‚úÖ dropoff_location
‚úÖ vehicle_type (SEDAN, SUV, VAN, LUXURY)
‚úÖ distance_km
‚úÖ calculated_fare_aed
‚úÖ service_type / booking_type
‚úÖ number_of_passengers
‚úÖ number_of_luggage
‚ùå vehicle_model ‚Üê MISSING (causes "N/A")
‚ùå assigned_vehicle_id ‚Üê MISSING (causes "None")

‚úÖ SOLUTION - WHAT BACKEND MUST DO
Step 1: Add Missing Columns to Database
-- Add new columns to bookings table
ALTER TABLE bookings 
ADD COLUMN vehicle_model VARCHAR(100) DEFAULT 'Not Assigned',
ADD COLUMN assigned_vehicle_id VARCHAR(50) DEFAULT NULL;
-- Optional: Add index for faster lookups
CREATE INDEX idx_assigned_vehicle_id ON bookings(assigned_vehicle_id);

Step 2: Update /api/bookings/create-manual Endpoint
Current API Response Issue:

‚ùå Accepts vehicle_model but ignores it
‚ùå Accepts assigned_vehicle_id but ignores it
‚ùå Returns booking without these fields populated
Required Fix:

# Pseudo-code for your backend
@app.post("/api/bookings/create-manual")
def create_manual_booking(payload):
    booking = Booking(
        customer_name=payload["customer_name"],
        customer_phone=payload["customer_phone"],
        customer_email=payload.get("customer_email"),
        pickup_location=payload["pickup_location"],
        dropoff_location=payload["dropoff_location"],
        booking_type=payload["booking_type"],
        vehicle_type=payload["vehicle_type"],
        
        # ‚úÖ ADD THESE LINES - CURRENTLY MISSING
        vehicle_model=payload.get("vehicle_model", "Not Assigned"),
        assigned_vehicle_id=payload.get("assigned_vehicle_id"),
        
        distance_km=payload.get("distance_km", 0),
        passengers_count=payload.get("passengers_count", 1),
        luggage_count=payload.get("luggage_count", 0),
    )
    
    db.session.add(booking)
    db.session.commit()
    
    return {
        "success": True,
        "booking": {
            "id": booking.id,
            "vehicle_model": booking.vehicle_model,        # ‚Üê Include in response
            "assigned_vehicle_id": booking.assigned_vehicle_id  # ‚Üê Include in response
        }
    }

Step 3: Update Booking Dashboard/UI
When displaying booking details, show:

Vehicle Model: {vehicle_model}           ‚Üê Display from DB
Assigned Vehicle: {assigned_vehicle_id}  ‚Üê Display from DB

üéØ TEST VALIDATION
After implementing, test with:

curl -X POST "https://your-backend.dev/api/bookings/create-manual" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "customer_name": "Test User",
    "customer_phone": "+971501234567",
    "pickup_location": "Dubai Airport",
    "dropoff_location": "Burj Khalifa",
    "vehicle_type": "SEDAN",
    "vehicle_model": "Toyota Camry",
    "assigned_vehicle_id": "VEH001",
    "distance_km": 25,
    "passengers_count": 2,
    "luggage_count": 1
  }'

Expected Response:

{
  "success": true,
  "message": "Booking created successfully",
  "booking": {
    "id": "6bf9f768...",
    "vehicle_model": "Toyota Camry",      ‚Üê ‚úÖ Should appear
    "assigned_vehicle_id": "VEH001",      ‚Üê ‚úÖ Should appear
    "status": "IN-PROCESS"
  }
}

üìù VEHICLE OPTIONS BAREERAH SENDS
Fleet inventory Bareerah randomly selects from:

Sedans: Toyota Camry, Toyota Corolla, Honda Civic, Nissan Altima, Honda Accord
Luxury: Lexus ES350, Mercedes Viano
SUVs: GMC Yukon, Chevrolet Tahoe
Vans: Toyota Previa, Mercedes Viano

Vehicle IDs: VEH001 through VEH010 (or your custom format)

