<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bareerah Admin Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBKM_1dVEQV4H5JFW52_j8fy0UOhH7KPdQ&libraries=places,geometry"></script>
</head>
<body>
  <div class="container">
    <!-- Titlebar -->
    <div class="titlebar">
      <h1>Bareerah Admin</h1>
      <div class="titlebar-right">
        <button class="theme-toggle" id="themeToggle">üåô</button>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Sidebar -->
      <aside class="sidebar">
        <a class="nav-item active" data-page="dashboard">üìä Dashboard</a>
        <a class="nav-item" data-page="kpi">üíπ KPI & Profits</a>
        <a class="nav-item" data-page="bookings">üìÖ Bookings</a>
        <div class="nav-submenu-toggle" onclick="toggleSubmenu(this)">üë• Drivers ‚ñº</div>
        <div class="nav-submenu" style="display: none;">
          <a class="nav-item" data-page="drivers-all">All Drivers</a>
          <a class="nav-item" data-page="drivers-online">Online</a>
          <a class="nav-item" data-page="drivers-offline">Offline</a>
        </div>
        <div class="nav-submenu-toggle" onclick="toggleSubmenu(this)">üöó Cars ‚ñº</div>
        <div class="nav-submenu" style="display: none;">
          <a class="nav-item" data-page="cars-all">All Cars</a>
          <a class="nav-item" data-page="cars-sedan">Sedan</a>
          <a class="nav-item" data-page="cars-suv">SUV</a>
          <a class="nav-item" data-page="cars-luxury">Luxury</a>
          <a class="nav-item" data-page="cars-van">Vans</a>
          <a class="nav-item" data-page="cars-bus">Bus</a>
          <a class="nav-item" data-page="cars-minibus">Mini Bus</a>
          <a class="nav-item" data-page="cars-add">‚ûï Add New Vehicle</a>
        </div>
        <a class="nav-item" data-page="fares">üí∞ Fare Rules</a>
        <a class="nav-item" data-page="settings">‚öôÔ∏è Settings</a>
        <a class="nav-item" data-page="alerts">üö® Alerts</a>
      </aside>

      <!-- Content Area -->
      <main class="content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
          <h2 class="page-title">Dashboard</h2>
          
          <!-- Filter Controls -->
          <div class="filter-bar">
            <div class="filter-group">
              <button class="filter-btn active" onclick="setDashboardRange('today'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">Today</button>
              <button class="filter-btn" onclick="setDashboardRange('yesterday'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">Yesterday</button>
              <button class="filter-btn" onclick="setDashboardRange('week'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">This Week</button>
              <button class="filter-btn" onclick="setDashboardRange('month'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">This Month</button>
              <button class="filter-btn" onclick="toggleCustomRange()">Custom Range</button>
            </div>
            <div class="date-picker" style="display: none;" id="customDatePicker">
              <input type="date" id="startDate">
              <span>to</span>
              <input type="date" id="endDate">
              <button class="btn btn-small btn-primary" onclick="applyCustomRange()">Apply</button>
            </div>
          </div>

          <!-- Summary Cards -->
          <div class="stats-grid">
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Bookings</div>
                <span class="stat-icon">üìä</span>
              </div>
              <div class="stat-value" id="stat-bookings">0</div>
              <div class="stat-subtitle">in selected period</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Completed</div>
                <span class="stat-icon">‚úÖ</span>
              </div>
              <div class="stat-value" id="stat-completed">0</div>
              <div class="stat-subtitle">successful rides</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Pending</div>
                <span class="stat-icon">‚è≥</span>
              </div>
              <div class="stat-value" id="stat-pending">0</div>
              <div class="stat-subtitle">awaiting completion</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Cancelled</div>
                <span class="stat-icon">‚ùå</span>
              </div>
              <div class="stat-value" id="stat-cancelled">0</div>
              <div class="stat-subtitle">cancelled rides</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Revenue</div>
                <span class="stat-icon">üí∞</span>
              </div>
              <div class="stat-value" id="stat-revenue">AED 0</div>
              <div class="stat-subtitle">completed bookings</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Cash vs Card</div>
                <span class="stat-icon">üí≥</span>
              </div>
              <div class="stat-split">
                <div class="split-item">
                  <span>Cash:</span>
                  <span id="stat-cash">AED 0</span>
                </div>
                <div class="split-item">
                  <span>Card:</span>
                  <span id="stat-card">AED 0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts Section -->
          <div class="charts-container">
            <div class="chart-card">
              <h3>7-Day Booking Trend</h3>
              <canvas id="bookingsChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Revenue by Vehicle Type</h3>
              <canvas id="revenueChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Top Drivers</h3>
              <div id="driversStats" class="drivers-list"></div>
            </div>
          </div>

          <!-- Alerts Panel -->
          <div class="alerts-panel">
            <h3>System Alerts</h3>
            <div id="alertsList" class="alerts-list"></div>
          </div>
        </div>

        <!-- KPI & Profits Page -->
        <div id="page-kpi" class="page">
          <h2 class="page-title">KPI & Profits Dashboard</h2>
          
          <div class="filter-bar">
            <div class="filter-group">
              <button class="filter-btn active" data-range="today" onclick="loadKPI()">Today</button>
              <button class="filter-btn" data-range="yesterday" onclick="loadKPI()">Yesterday</button>
              <button class="filter-btn" data-range="week" onclick="loadKPI()">This Week</button>
              <button class="filter-btn" data-range="month" onclick="loadKPI()">This Month</button>
            </div>
          </div>

          <!-- KPI Cards -->
          <div class="stats-grid">
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Revenue</div>
                <span class="stat-icon">üí∞</span>
              </div>
              <div class="stat-value" id="kpi-total-revenue">AED 0</div>
              <div class="stat-subtitle">total earnings</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Vendor Commission</div>
                <span class="stat-icon">üè¢</span>
              </div>
              <div class="stat-value" id="kpi-vendor-commission">AED 0</div>
              <div class="stat-subtitle">paid to vendors</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Net Company Profit</div>
                <span class="stat-icon">üìà</span>
              </div>
              <div class="stat-value" id="kpi-company-profit">AED 0</div>
              <div class="stat-subtitle">our earnings</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Profit Margin</div>
                <span class="stat-icon">üìä</span>
              </div>
              <div class="stat-value" id="kpi-profit-margin">0%</div>
              <div class="stat-subtitle">company profit %</div>
            </div>
          </div>

          <!-- Charts -->
          <div class="charts-container">
            <div class="chart-card">
              <h3>Earnings Breakdown by Timeframe</h3>
              <canvas id="earningsChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Company vs Vendor Earnings</h3>
              <canvas id="companyVendorChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Top Vendors by Revenue</h3>
              <div id="topVendorsList" class="vendors-list"></div>
            </div>
          </div>
        </div>

        <!-- Bookings Page -->
        <div id="page-bookings" class="page">
          <h2 class="page-title">Bookings</h2>
          
          <div class="filter-bar">
            <div class="filter-group">
              <button class="filter-btn active" data-range="today">Today</button>
              <button class="filter-btn" data-range="yesterday">Yesterday</button>
              <button class="filter-btn" data-range="week">Week</button>
              <button class="filter-btn" data-range="month">Month</button>
            </div>
            <div class="search-box">
              <input type="text" id="bookingSearch" placeholder="Search by name, phone, or location...">
            </div>
            <div class="filter-dropdowns">
              <select id="statusFilter">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
              <select id="vehicleFilter">
                <option value="">All Vehicles</option>
                <option value="sedan">Sedan</option>
                <option value="suv">SUV</option>
                <option value="luxury">Luxury</option>
                <option value="van">Van</option>
                <option value="bus">Bus</option>
                <option value="minibus">Mini Bus</option>
              </select>
            </div>
            <button class="btn btn-primary" onclick="openAddBookingModal()">‚ûï Add Booking</button>
            <button class="btn btn-primary" onclick="exportBookings('csv')">üì• Export CSV</button>
          </div>

          <div class="card">
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Booking ID</th>
                    <th>Customer</th>
                    <th>Phone</th>
                    <th>Pickup</th>
                    <th>Drop</th>
                    <th>Distance (km)</th>
                    <th>Vehicle</th>
                    <th>Fare</th>
                    <th>Driver</th>
                    <th>Payment</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="bookings-table-body">
                  <tr><td colspan="13" style="text-align: center; color: var(--text-secondary);">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Drivers Pages -->
        <div id="page-drivers-all" class="page">
          <h2 class="page-title">Drivers</h2>
          <div class="card">
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Car Assigned</th>
                    <th>Total Trips</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="drivers-table-body">
                  <tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Drivers Online Page -->
        <div id="page-drivers-online" class="page">
          <h2 class="page-title">Online Drivers</h2>
          <div class="card">
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Car Assigned</th>
                    <th>Total Trips</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="drivers-online-table-body">
                  <tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Drivers Offline Page -->
        <div id="page-drivers-offline" class="page">
          <h2 class="page-title">Offline Drivers</h2>
          <div class="card">
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Car Assigned</th>
                    <th>Total Trips</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="drivers-offline-table-body">
                  <tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Cars Pages -->
        <div id="page-cars-all" class="page">
          <h2 class="page-title">Vehicles</h2>
          <div class="card">
            <div class="table-container" id="carsGrid">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- Sedan Cars Page -->
        <div id="page-cars-sedan" class="page">
          <h2 class="page-title">Sedan Vehicles</h2>
          <div class="card">
            <div class="table-container" id="carsGridSedan">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- SUV Cars Page -->
        <div id="page-cars-suv" class="page">
          <h2 class="page-title">SUV Vehicles</h2>
          <div class="card">
            <div class="table-container" id="carsGridSuv">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- Luxury Cars Page -->
        <div id="page-cars-luxury" class="page">
          <h2 class="page-title">Luxury Vehicles</h2>
          <div class="card">
            <div class="table-container" id="carsGridLuxury">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- Van Cars Page -->
        <div id="page-cars-van" class="page">
          <h2 class="page-title">Vans</h2>
          <div class="card">
            <div class="table-container" id="carsGridVan">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- Bus Cars Page -->
        <div id="page-cars-bus" class="page">
          <h2 class="page-title">Bus Vehicles</h2>
          <div class="card">
            <div class="table-container" id="carsGridBus">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- Mini Bus Cars Page -->
        <div id="page-cars-minibus" class="page">
          <h2 class="page-title">Mini Bus Vehicles</h2>
          <div class="card">
            <div class="table-container" id="carsGridMinibus">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- Add Vehicle Page -->
        <div id="page-cars-add" class="page">
          <h2 class="page-title">Add New Vehicle</h2>
          <div class="card">
            <form id="addVehicleForm" style="display: grid; gap: 15px;">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                  <label>Plate Number</label>
                  <input type="text" id="addVehiclePlate" placeholder="e.g. ABC-1234" required>
                </div>
                <div class="form-group">
                  <label>Model</label>
                  <input type="text" id="addVehicleModel" placeholder="e.g. Toyota Corolla" required>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                  <label>Vehicle Type</label>
                  <select id="addVehicleType" required>
                    <option value="">Select Type</option>
                    <option value="sedan">Sedan</option>
                    <option value="suv">SUV</option>
                    <option value="luxury">Luxury</option>
                    <option value="van">Van</option>
                    <option value="bus">Bus</option>
                    <option value="minibus">Mini Bus</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Status</label>
                  <select id="addVehicleStatus" required>
                    <option value="available">Available</option>
                    <option value="maintenance">Maintenance</option>
                    <option value="rented">Rented</option>
                  </select>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                  <label>Max Passengers</label>
                  <input type="number" id="addVehiclePassengers" value="4" min="1" required>
                </div>
                <div class="form-group">
                  <label>Max Luggage</label>
                  <input type="number" id="addVehicleLuggage" value="3" min="0" required>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                  <label>Per KM Price (AED)</label>
                  <input type="number" id="addVehiclePerKm" value="3.5" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                  <label>Hourly Price (AED)</label>
                  <input type="number" id="addVehicleHourly" value="75" step="0.01" min="0" required>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                  <label>üé® Car Color</label>
                  <input type="text" id="addVehicleColor" placeholder="e.g. Silver, Black, White" value="White" required>
                </div>
                <div class="form-group">
                  <label>üì∑ Car Image (jpg/png/webp, max 2MB)</label>
                  <input type="file" id="addVehicleImage" accept=".jpg,.jpeg,.png,.webp">
                </div>
              </div>
              <div class="form-group">
                <label>Vendor ID (optional)</label>
                <input type="text" id="addVehicleVendor" placeholder="Leave empty for Gold Rush Limo">
              </div>
              <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-size: 1em;">Add Vehicle</button>
            </form>
          </div>
        </div>

        <!-- Fare Rules Page -->
        <div id="page-fares" class="page">
          <h2 class="page-title">Fare Rules Configuration</h2>
          <div class="card">
            <form id="fareForm">
              <div class="form-grid">
                <div class="form-group">
                  <label>Base Fare (AED)</label>
                  <input type="number" id="baseFare" value="5" step="0.01">
                </div>
                <div class="form-group">
                  <label>Per Km Rate - Sedan (AED)</label>
                  <input type="number" id="sedanKmRate" value="3.5" step="0.01">
                </div>
                <div class="form-group">
                  <label>Per Km Rate - SUV (AED)</label>
                  <input type="number" id="suvKmRate" value="4.5" step="0.01">
                </div>
                <div class="form-group">
                  <label>Per Km Rate - Luxury (AED)</label>
                  <input type="number" id="luxuryKmRate" value="6.5" step="0.01">
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Save Fare Rules</button>
            </form>
          </div>
        </div>

        <!-- Settings Page -->
        <div id="page-settings" class="page">
          <h2 class="page-title">Settings</h2>
          <div class="card">
            <h3>API Configuration</h3>
            <div class="form-group">
              <label>API Base URL</label>
              <input type="text" id="apiUrl" readonly>
            </div>
            <h3 style="margin-top: 30px;">System Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <span>Dashboard Version</span>
                <strong>2.1.0</strong>
              </div>
              <div class="info-item">
                <span>Last Updated</span>
                <strong id="lastUpdated">--</strong>
              </div>
              <div class="info-item">
                <span>User</span>
                <strong id="currentUser">--</strong>
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts Page -->
        <div id="page-alerts" class="page">
          <h2 class="page-title">System Alerts</h2>
          <div class="card">
            <div id="alertsFullList" class="alerts-full-list"></div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Booking Detail Modal -->
  <div id="bookingDetailModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Booking Details</h3>
        <button class="modal-close" onclick="closeModal('bookingDetailModal')">√ó</button>
      </div>
      <div class="modal-body" id="bookingDetailContent">
        Loading...
      </div>
      <div style="padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 10px; justify-content: flex-end;">
        <button onclick="closeModal('bookingDetailModal')" class="btn" style="background: var(--bg-secondary);">Close</button>
        <button id="detailEditBtn" onclick="openDetailEditModal()" class="btn btn-primary">Edit Booking</button>
      </div>
    </div>
  </div>

  <!-- Edit Booking Modal -->
  <div id="editBookingModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h3>Edit Booking</h3>
        <button class="modal-close" onclick="closeModal('editBookingModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="editBookingForm" style="display: grid; gap: 12px;">
          <input type="hidden" id="editBookingId">
          <div class="form-group">
            <label>Booking Status</label>
            <select id="editStatus" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
              <option value="pending">Pending</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          <div class="form-group">
            <label>Booking Type</label>
            <select id="editBookingType" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
              <option value="point_to_point">Point to Point</option>
              <option value="airport_transfer">Airport Transfer</option>
              <option value="city_tour">City Tour</option>
              <option value="hourly_rental">Hourly Rental</option>
            </select>
          </div>
          <div class="form-group" style="position: relative;">
            <label>Pickup Location</label>
            <input type="text" id="editPickup" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; position: relative; z-index: 5;">
            <div id="pickupSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-primary); border: 1px solid var(--border); border-top: none; border-radius: 0 0 6px 6px; max-height: 150px; overflow-y: auto; z-index: 250; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: none;"></div>
          </div>
          <div class="form-group" style="position: relative;">
            <label>Dropoff Location</label>
            <input type="text" id="editDropoff" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; position: relative; z-index: 5;">
            <div id="dropoffSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-primary); border: 1px solid var(--border); border-top: none; border-radius: 0 0 6px 6px; max-height: 150px; overflow-y: auto; z-index: 250; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: none;"></div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
            <div class="form-group">
              <label>Distance (km)</label>
              <input type="number" id="editDistance" step="0.1" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;" placeholder="Auto-calculated">
            </div>
          </div>
          <div class="form-group">
            <label>Vehicle Type</label>
            <select id="editVehicleType" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
              <option value="sedan">Sedan</option>
              <option value="suv">SUV</option>
              <option value="luxury">Luxury</option>
              <option value="van">Van</option>
              <option value="bus">Bus</option>
              <option value="minibus">Mini Bus</option>
            </select>
          </div>
          <div class="form-group">
            <label>Vehicle Model</label>
            <select id="editVehicleModel" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
              <option value="">-- Select Vehicle Model --</option>
            </select>
          </div>
          <div class="form-group">
            <label>Payment Method</label>
            <select id="editPayment" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
              <option value="cash">Cash</option>
              <option value="card">Card</option>
            </select>
          </div>
          <div class="form-group">
            <label>Fare Amount (AED)</label>
            <input type="number" id="editFare" step="0.01" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
          </div>
          <div class="form-group">
            <label>Driver Assignment</label>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px;">
              <button type="button" onclick="setAssignmentMode('manual')" id="manualAssignBtn" class="btn" style="background: var(--bg-secondary);">Manual Assign</button>
              <button type="button" onclick="setAssignmentMode('auto')" id="autoAssignBtn" class="btn" style="background: #10b981; color: white;">Auto Assign</button>
            </div>
            <select id="editDriver" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; display: none;">
              <option value="">-- Select Driver --</option>
            </select>
            <div id="autoAssignStatus" style="padding: 8px; background: #10b981; color: white; border-radius: 6px; display: none; text-align: center;">Will auto-assign on save</div>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%;">Save Changes</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Driver View Modal -->
  <div id="driverViewModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Driver Details</h3>
        <button class="modal-close" onclick="closeModal('driverViewModal')">√ó</button>
      </div>
      <div class="modal-body">
        <!-- Driver Picture Section -->
        <div style="text-align: center; margin-bottom: 20px;">
          <img id="driverViewImage" src="" alt="Driver" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--border); background: var(--bg-secondary);">
        </div>
        
        <!-- Driver Info -->
        <div class="form-group">
          <label>Name</label>
          <input type="text" id="driverViewName" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary);">
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="text" id="driverViewPhone" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary);">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="text" id="driverViewEmail" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary);">
        </div>
        
        <!-- Status & Rating Section -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
          <div class="form-group">
            <label>Status</label>
            <input type="text" id="driverViewStatus" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary);">
          </div>
          <div class="form-group">
            <label>Rating</label>
            <input type="text" id="driverViewRating" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary);">
          </div>
        </div>
        
        <!-- License Section -->
        <div class="form-group">
          <label>License Number</label>
          <input type="text" id="driverViewLicense" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary);">
        </div>
        <div class="form-group">
          <label>License Expiry Date</label>
          <input type="text" id="driverViewLicenseExpiry" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-secondary);">
        </div>
        
        <!-- Auto Assign Section -->
        <div class="form-group">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="driverViewAutoAssign" disabled style="width: 18px; height: 18px; cursor: not-allowed;">
            <span>Auto Assign Enabled</span>
          </label>
        </div>
        
        <button onclick="closeModal('driverViewModal')" class="btn" style="width: 100%;">Close</button>
      </div>
    </div>
  </div>

  <!-- Driver Edit Modal -->
  <div id="driverEditModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Driver</h3>
        <button class="modal-close" onclick="closeModal('driverEditModal')">√ó</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="driverEditId">
        <div class="form-group">
          <label>Name</label>
          <input type="text" id="driverName" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="text" id="driverPhone" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="text" id="driverEmail" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="driverStatus" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
            <option value="online">Online</option>
            <option value="offline">Offline</option>
          </select>
        </div>
        
        <!-- Auto Assign Checkbox -->
        <div class="form-group">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="driverAutoAssign" style="width: 18px; height: 18px; cursor: pointer;">
            <span>Enable Auto Assign</span>
          </label>
          <small style="color: var(--text-secondary); display: block; margin-top: 4px;">If unchecked, this driver will NOT be auto-assigned to bookings</small>
        </div>
        
        <button onclick="saveDriverChanges()" class="btn btn-primary" style="width: 100%;">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Vehicle Edit Modal -->
  <div id="vehicleEditModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Vehicle</h3>
        <button class="modal-close" onclick="closeModal('vehicleEditModal')">√ó</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="vehicleEditId">
        <div class="form-group">
          <label>Model</label>
          <input type="text" id="vehicleModel" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Type</label>
          <select id="vehicleType" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
            <option value="sedan">Sedan</option>
            <option value="suv">SUV</option>
            <option value="luxury">Luxury</option>
            <option value="van">Van</option>
            <option value="minibus">Mini Bus</option>
          </select>
        </div>
        <div class="form-group">
          <label>Status</label>
          <select id="vehicleStatus" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
            <option value="available">Available</option>
            <option value="on_trip">On Trip</option>
            <option value="maintenance">Maintenance</option>
          </select>
        </div>
        <button onclick="saveCarChanges()" class="btn btn-primary" style="width: 100%;">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Add Booking Modal -->
  <div id="addBookingModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create Booking</h3>
        <button class="modal-close" onclick="closeModal('addBookingModal')">√ó</button>
      </div>
      <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
        <div class="form-group">
          <label>Customer Name</label>
          <input type="text" id="bookingCustomerName" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="bookingCustomerEmail" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Phone</label>
          <input type="text" id="bookingCustomerPhone" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group" style="position: relative;">
          <label>Pickup Location</label>
          <input type="text" id="bookingPickup" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; position: relative; z-index: 5;">
          <div id="addPickupSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-primary); border: 1px solid var(--border); border-top: none; border-radius: 0 0 6px 6px; max-height: 150px; overflow-y: auto; z-index: 250; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: none;"></div>
        </div>
        <div class="form-group" style="position: relative;">
          <label>Dropoff Location</label>
          <input type="text" id="bookingDropoff" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; position: relative; z-index: 5;">
          <div id="addDropoffSuggestions" style="position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-primary); border: 1px solid var(--border); border-top: none; border-radius: 0 0 6px 6px; max-height: 150px; overflow-y: auto; z-index: 250; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: none;"></div>
        </div>
        <div class="form-group">
          <label>Distance (km)</label>
          <input type="number" id="bookingDistance" step="0.1" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Passengers</label>
          <input type="number" id="bookingPassengers" value="1" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Luggage</label>
          <input type="number" id="bookingLuggage" value="0" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
        </div>
        <div class="form-group">
          <label>Booking Type</label>
          <select id="bookingType" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
            <option value="point-to-point">Point to Point</option>
            <option value="airport-transfer">Airport Transfer</option>
            <option value="hourly">Hourly Rental</option>
            <option value="city-tour">City Tour</option>
          </select>
        </div>
        <div class="form-group">
          <label>Vehicle Type</label>
          <select id="bookingVehicleType" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
            <option value="sedan">Sedan</option>
            <option value="suv">SUV</option>
            <option value="luxury">Luxury</option>
            <option value="van">Van</option>
            <option value="bus">Bus</option>
            <option value="minibus">Mini Bus</option>
          </select>
        </div>
        <div class="form-group">
          <label>Vehicle Model</label>
          <select id="bookingVehicleModel" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
            <option value="">-- Select Vehicle Model --</option>
          </select>
        </div>
        <div class="form-group">
          <label>Payment Method</label>
          <select id="bookingPayment" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
            <option value="cash">Cash</option>
            <option value="card">Card</option>
          </select>
        </div>
        <button onclick="createManualBooking()" class="btn btn-primary" style="width: 100%;">Create Booking</button>
      </div>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div id="modalOverlay" class="modal-overlay" style="display: none;" onclick="closeModal()"></div>

  <script src="js/app.js?v=16"></script>
</body>
</html>
