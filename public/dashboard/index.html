<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Star Skyline Limousine Admin Dashboard</title>
    <link rel="stylesheet" href="css/styles.css?v=20251210" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBKM_1dVEQV4H5JFW52_j8fy0UOhH7KPdQ&libraries=places,geometry"></script>
  </head>
  <body>
    <div class="container">
      <!-- Titlebar -->
      <div class="titlebar">
        <h1>Star Skyline Limousine Admin</h1>
        <div class="titlebar-right">
          <button class="theme-toggle" id="themeToggle">üåô</button>
          <button
            class="cache-clear-btn"
            onclick="clearCacheNow()"
            title="Clear cache to see latest data"
          >
            üîÑ Clear Cache
          </button>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle Sidebar">‚ò∞</button>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
          <a class="nav-item active" data-page="dashboard">üìä Dashboard</a>
          <a class="nav-item" data-page="kpi">üíπ KPI & Profits</a>
          <a class="nav-item" data-page="bookings">üìÖ Bookings</a>
          <a class="nav-item" data-page="vendors">üè¢ Vendors</a>
          <a
            href="#"
            onclick="navigateToPage('logs')"
            class="nav-item"
            data-page="logs"
            >üìã Logs</a
          >
          <div class="nav-submenu-toggle" onclick="toggleSubmenu(this)">
            üë• Drivers ‚ñº
          </div>
          <div class="nav-submenu" style="display: none">
            <a class="nav-item" data-page="drivers-all">All Drivers</a>
            <a class="nav-item" data-page="drivers-online">Online</a>
            <a class="nav-item" data-page="drivers-offline">Offline</a>
          </div>
          <div class="nav-submenu-toggle" onclick="toggleSubmenu(this)">
            üöó Cars ‚ñº
          </div>
          <div class="nav-submenu" style="display: none">
            <a class="nav-item" data-page="cars-all">All Cars</a>
            <a class="nav-item" data-page="cars-sedan">Sedan</a>
            <a class="nav-item" data-page="cars-suv">SUV</a>
            <a class="nav-item" data-page="cars-luxury">Luxury</a>
            <a class="nav-item" data-page="cars-van">Vans</a>
            <a class="nav-item" data-page="cars-bus">Bus</a>
            <a class="nav-item" data-page="cars-minibus">Mini Bus</a>
            <a class="nav-item" data-page="cars-add">‚ûï Add New Vehicle</a>
          </div>
          <a class="nav-item" data-page="fares">üí∞ Fare Rules</a>
          <a class="nav-item" data-page="rental-rules">‚è∞ Hourly Rentals</a>
          <a class="nav-item" data-page="settings">‚öôÔ∏è Settings</a>
          <a class="nav-item" data-page="alerts">üö® Alerts</a>
        </aside>

        <!-- Content Area -->
        <main class="content">
          <!-- Dashboard Page -->
          <div id="page-dashboard" class="page active">
            <h2 class="page-title">Dashboard</h2>

            <!-- Filter Controls -->
            <div class="filter-bar">
              <div class="filter-group">
                <button
                  class="filter-btn active"
                  onclick="setDashboardRange('today'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');"
                >
                  Today
                </button>
                <button
                  class="filter-btn"
                  onclick="setDashboardRange('yesterday'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');"
                >
                  Yesterday
                </button>
                <button
                  class="filter-btn"
                  onclick="setDashboardRange('week'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');"
                >
                  This Week
                </button>
                <button
                  class="filter-btn"
                  onclick="setDashboardRange('month'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');"
                >
                  This Month
                </button>
                <button class="filter-btn" onclick="toggleCustomRange()">
                  Custom Range
                </button>
              </div>
              <div
                class="date-picker"
                style="display: none"
                id="customDatePicker"
              >
                <input type="date" id="startDate" />
                <span>to</span>
                <input type="date" id="endDate" />
                <button
                  class="btn btn-small btn-primary"
                  onclick="applyCustomRange()"
                >
                  Apply
                </button>
              </div>
            </div>

            <!-- Summary Cards -->
            <div class="stats-grid">
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Total Bookings</div>
                  <span class="stat-icon">üìä</span>
                </div>
                <div class="stat-value" id="stat-bookings">0</div>
                <div class="stat-subtitle">in selected period</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Completed</div>
                  <span class="stat-icon">‚úÖ</span>
                </div>
                <div class="stat-value" id="stat-completed">0</div>
                <div class="stat-subtitle">successful rides</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Pending</div>
                  <span class="stat-icon">‚è≥</span>
                </div>
                <div class="stat-value" id="stat-pending">0</div>
                <div class="stat-subtitle">awaiting completion</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Cancelled</div>
                  <span class="stat-icon">‚ùå</span>
                </div>
                <div class="stat-value" id="stat-cancelled">0</div>
                <div class="stat-subtitle">cancelled rides</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Total Revenue</div>
                  <span class="stat-icon">üí∞</span>
                </div>
                <div class="stat-value" id="stat-revenue">AED 0</div>
                <div class="stat-subtitle">completed bookings</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Cash vs Card</div>
                  <span class="stat-icon">üí≥</span>
                </div>
                <div class="stat-split">
                  <div class="split-item">
                    <span>Cash:</span>
                    <span id="stat-cash">AED 0</span>
                  </div>
                  <div class="split-item">
                    <span>Card:</span>
                    <span id="stat-card">AED 0</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
              <div class="chart-card">
                <h3>7-Day Booking Trend</h3>
                <canvas id="bookingsChart"></canvas>
              </div>
              <div class="chart-card">
                <h3>Revenue by Vehicle Type</h3>
                <canvas id="revenueChart"></canvas>
              </div>
              <div class="chart-card">
                <h3>Top Drivers</h3>
                <div id="driversStats" class="drivers-list"></div>
              </div>
            </div>

            <!-- Alerts Panel -->
            <div class="alerts-panel">
              <h3>System Alerts</h3>
              <div id="alertsList" class="alerts-list"></div>
            </div>
          </div>

          <!-- KPI & Profits Page -->
          <div id="page-kpi" class="page">
            <h2 class="page-title">KPI & Profits Dashboard</h2>

            <div class="filter-bar">
              <div class="filter-group">
                <button
                  class="filter-btn active"
                  data-range="today"
                  onclick="this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active'); loadKPI();"
                >
                  Today
                </button>
                <button
                  class="filter-btn"
                  data-range="yesterday"
                  onclick="this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active'); loadKPI();"
                >
                  Yesterday
                </button>
                <button
                  class="filter-btn"
                  data-range="week"
                  onclick="this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active'); loadKPI();"
                >
                  This Week
                </button>
                <button
                  class="filter-btn"
                  data-range="month"
                  onclick="this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active'); loadKPI();"
                >
                  This Month
                </button>
              </div>
              <button class="btn btn-primary" onclick="exportKPIReport('csv')">
                üì• Export CSV
              </button>
            </div>

            <!-- KPI Cards -->
            <div class="stats-grid">
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Total Revenue</div>
                  <span class="stat-icon">üí∞</span>
                </div>
                <div class="stat-value" id="kpi-total-revenue">AED 0</div>
                <div class="stat-subtitle">total earnings</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Vendor Commission</div>
                  <span class="stat-icon">üè¢</span>
                </div>
                <div class="stat-value" id="kpi-vendor-commission">AED 0</div>
                <div class="stat-subtitle">paid to vendors</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Net Company Profit</div>
                  <span class="stat-icon">üìà</span>
                </div>
                <div class="stat-value" id="kpi-company-profit">AED 0</div>
                <div class="stat-subtitle">our earnings</div>
              </div>
              <div class="stat-card glass">
                <div class="stat-header">
                  <div class="stat-label">Profit Margin</div>
                  <span class="stat-icon">üìä</span>
                </div>
                <div class="stat-value" id="kpi-profit-margin">0%</div>
                <div class="stat-subtitle">company profit %</div>
              </div>
            </div>

            <!-- Charts -->
            <div class="charts-container">
              <div class="chart-card">
                <h3>Earnings Breakdown by Timeframe</h3>
                <canvas id="earningsChart"></canvas>
              </div>
              <div class="chart-card">
                <h3>Company vs Vendor Earnings</h3>
                <canvas id="companyVendorChart"></canvas>
              </div>
              <div class="chart-card">
                <h3>Top Vendors by Revenue</h3>
                <div id="topVendorsList" class="vendors-list"></div>
              </div>
            </div>
          </div>

          <!-- Bookings Page -->
          <div id="page-bookings" class="page">
            <h2 class="page-title">Bookings</h2>

            <div class="filter-bar">
              <div class="filter-group">
                <button class="filter-btn active" data-range="today">
                  Today
                </button>
                <button class="filter-btn" data-range="yesterday">
                  Yesterday
                </button>
                <button class="filter-btn" data-range="week">Week</button>
                <button class="filter-btn" data-range="month">Month</button>
              </div>
              <div class="search-box">
                <input
                  type="text"
                  id="bookingSearch"
                  placeholder="Search by name, phone, or location..."
                />
              </div>
              <div class="filter-dropdowns">
                <select id="statusFilter">
                  <option value="">All Status</option>
                  <option value="pending">Pending</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
                <select id="vehicleFilter">
                  <option value="">All Vehicles</option>
                  <option value="sedan">Sedan</option>
                  <option value="suv">SUV</option>
                  <option value="luxury">Luxury</option>
                  <option value="van">Van</option>
                  <option value="bus">Bus</option>
                  <option value="minibus">Mini Bus</option>
                </select>
              </div>
              <button class="btn btn-primary" onclick="openAddBookingModal()">
                ‚ûï Add Booking
              </button>
              <button class="btn btn-primary" onclick="exportBookings('csv')">
                üì• Export CSV
              </button>
            </div>

            <div class="card">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Booking ID</th>
                      <th>Source</th>
                      <th>Customer</th>
                      <th>Phone</th>
                      <th>Pickup</th>
                      <th>Drop</th>
                      <th>Distance (km)</th>
                      <th>Vehicle</th>
                      <th>Fare</th>
                      <th>Driver</th>
                      <th>Payment</th>
                      <th>Status</th>
                      <th>Created</th>
                      <th>Updated</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="bookings-table-body">
                    <tr>
                      <td
                        colspan="15"
                        style="text-align: center; color: var(--text-secondary)"
                      >
                        Loading...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Vendors Page -->
          <div id="page-vendors" class="page">
            <h2 class="page-title">Vendors Management</h2>
            <div class="filter-bar">
              <select
                id="vendor-status-filter"
                onchange="filterVendors(this.value)"
                class="filter-select"
              >
                <option value="">All Vendors</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
              </select>
            </div>
            <div class="card">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Company Name</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Status</th>
                      <th>Vehicles</th>
                      <th>Earnings</th>
                      <th>Completed Bookings</th>
                      <th>Auto-Assign</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="vendors-table-body">
                    <tr>
                      <td
                        colspan="10"
                        style="text-align: center; color: var(--text-secondary)"
                      >
                        Loading...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Drivers Pages -->
          <div id="page-drivers-all" class="page">
            <h2 class="page-title">Drivers</h2>
            <div class="card">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Phone</th>
                      <th>Status</th>
                      <th>Car Assigned</th>
                      <th>Total Trips</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="drivers-table-body">
                    <tr>
                      <td
                        colspan="7"
                        style="text-align: center; color: var(--text-secondary)"
                      >
                        Loading...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Drivers Online Page -->
          <div id="page-drivers-online" class="page">
            <h2 class="page-title">Online Drivers</h2>
            <div class="card">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Phone</th>
                      <th>Status</th>
                      <th>Car Assigned</th>
                      <th>Total Trips</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="drivers-online-table-body">
                    <tr>
                      <td
                        colspan="7"
                        style="text-align: center; color: var(--text-secondary)"
                      >
                        Loading...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Drivers Offline Page -->
          <div id="page-drivers-offline" class="page">
            <h2 class="page-title">Offline Drivers</h2>
            <div class="card">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Phone</th>
                      <th>Status</th>
                      <th>Car Assigned</th>
                      <th>Total Trips</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="drivers-offline-table-body">
                    <tr>
                      <td
                        colspan="7"
                        style="text-align: center; color: var(--text-secondary)"
                      >
                        Loading...
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Cars Pages -->
          <div id="page-cars-all" class="page">
            <h2 class="page-title">Vehicles</h2>
            <div class="card">
              <div class="table-container" id="carsGrid">
                <p>Loading...</p>
              </div>
            </div>
          </div>

          <!-- Sedan Cars Page -->
          <div id="page-cars-sedan" class="page">
            <h2 class="page-title">Sedan Vehicles</h2>
            <div class="card">
              <div class="table-container" id="carsGridSedan">
                <p>Loading...</p>
              </div>
            </div>
          </div>

          <!-- SUV Cars Page -->
          <div id="page-cars-suv" class="page">
            <h2 class="page-title">SUV Vehicles</h2>
            <div class="card">
              <div class="table-container" id="carsGridSuv">
                <p>Loading...</p>
              </div>
            </div>
          </div>

          <!-- Luxury Cars Page -->
          <div id="page-cars-luxury" class="page">
            <h2 class="page-title">Luxury Vehicles</h2>
            <div class="card">
              <div class="table-container" id="carsGridLuxury">
                <p>Loading...</p>
              </div>
            </div>
          </div>

          <!-- Van Cars Page -->
          <div id="page-cars-van" class="page">
            <h2 class="page-title">Vans</h2>
            <div class="card">
              <div class="table-container" id="carsGridVan">
                <p>Loading...</p>
              </div>
            </div>
          </div>

          <!-- Bus Cars Page -->
          <div id="page-cars-bus" class="page">
            <h2 class="page-title">Bus Vehicles</h2>
            <div class="card">
              <div class="table-container" id="carsGridBus">
                <p>Loading...</p>
              </div>
            </div>
          </div>

          <!-- Mini Bus Cars Page -->
          <div id="page-cars-minibus" class="page">
            <h2 class="page-title">Mini Bus Vehicles</h2>
            <div class="card">
              <div class="table-container" id="carsGridMinibus">
                <p>Loading...</p>
              </div>
            </div>
          </div>

          <!-- Add Vehicle Page -->
          <div id="page-cars-add" class="page">
            <h2 class="page-title">Add New Vehicle</h2>
            <div class="card">
              <form id="addVehicleForm" style="display: grid; gap: 15px">
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 15px;
                  "
                >
                  <div class="form-group">
                    <label>Plate Number</label>
                    <input
                      type="text"
                      id="addVehiclePlate"
                      placeholder="e.g. ABC-1234"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label>Model</label>
                    <input
                      type="text"
                      id="addVehicleModel"
                      placeholder="e.g. Toyota Corolla"
                      required
                    />
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 15px;
                  "
                >
                  <div class="form-group">
                    <label>Vehicle Type</label>
                    <select id="addVehicleType" required>
                      <option value="">Select Type</option>
                      <option value="sedan">Sedan</option>
                      <option value="suv">SUV</option>
                      <option value="luxury">Luxury</option>
                      <option value="van">Van</option>
                      <option value="bus">Bus</option>
                      <option value="minibus">Mini Bus</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Status</label>
                    <select id="addVehicleStatus" required>
                      <option value="available">Available</option>
                      <option value="maintenance">Maintenance</option>
                      <option value="rented">Rented</option>
                    </select>
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 15px;
                  "
                >
                  <div class="form-group">
                    <label>Max Passengers</label>
                    <input
                      type="number"
                      id="addVehiclePassengers"
                      value="4"
                      min="1"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label>Max Luggage</label>
                    <input
                      type="number"
                      id="addVehicleLuggage"
                      value="3"
                      min="0"
                      required
                    />
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 15px;
                  "
                >
                  <div class="form-group">
                    <label>Per KM Price (AED)</label>
                    <input
                      type="number"
                      id="addVehiclePerKm"
                      value="3.5"
                      step="0.01"
                      min="0"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label>Hourly Price (AED)</label>
                    <input
                      type="number"
                      id="addVehicleHourly"
                      value="75"
                      step="0.01"
                      min="0"
                      required
                    />
                  </div>
                </div>
                <div
                  style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 15px;
                  "
                >
                  <div class="form-group">
                    <label>üé® Car Color</label>
                    <input
                      type="text"
                      id="addVehicleColor"
                      placeholder="e.g. Silver, Black, White"
                      value="White"
                      required
                    />
                  </div>
                  <div class="form-group">
                    <label>üì∑ Car Image (jpg/png/webp, max 2MB)</label>
                    <input
                      type="file"
                      id="addVehicleImage"
                      accept=".jpg,.jpeg,.png,.webp"
                    />
                  </div>
                </div>
                <div class="form-group">
                  <label>Vendor ID (optional)</label>
                  <input
                    type="text"
                    id="addVehicleVendor"
                    placeholder="Leave empty for Gold Rush Limo"
                  />
                </div>
                <button
                  type="submit"
                  class="btn btn-primary"
                  style="width: 100%; padding: 12px; font-size: 1em"
                >
                  Add Vehicle
                </button>
              </form>
            </div>
          </div>

          <!-- Fare Rules Page -->
          <div id="page-fares" class="page">
            <h2 class="page-title">Fare Rules Management (Slab-Based Logic)</h2>
            <div class="card">
              <p style="margin-bottom: 20px; color: var(--text-secondary)">
                Logic: If distance ‚â§ included_km ‚Üí base fare only. Else ‚Üí base
                fare + (distance √ó per_km). Changes apply to NEW bookings only.
              </p>
              <table style="width: 100%; border-collapse: collapse">
                <thead>
                  <tr style="border-bottom: 2px solid var(--border)">
                    <th
                      style="padding: 12px; text-align: left; font-weight: 600"
                    >
                      Vehicle Type
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: left;
                        font-weight: 600;
                        color: var(--text-secondary);
                        font-size: 0.9em;
                      "
                    >
                      Includes (Car Models)
                    </th>
                    <th
                      style="padding: 12px; text-align: right; font-weight: 600"
                    >
                      Base Fare (AED)
                    </th>
                    <th
                      style="padding: 12px; text-align: right; font-weight: 600"
                    >
                      Included KM
                    </th>
                    <th
                      style="padding: 12px; text-align: right; font-weight: 600"
                    >
                      Per KM Rate (AED)
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        font-weight: 600;
                      "
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody id="fareRulesTableBody">
                  <tr>
                    <td colspan="6" style="text-align: center; padding: 20px">
                      Loading fare rules...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Hourly Rental Rules Page -->
          <div id="page-rental-rules" class="page">
            <h2 class="page-title">Hourly Rental Pricing Rules</h2>
            <div class="card">
              <p style="margin-bottom: 20px; color: var(--text-secondary)">
                ‚ÑπÔ∏è Hourly rental bookings: Minimum 3 hours, Maximum 14 hours.
                Total fare = Hourly Rate √ó Hours. Changes apply to NEW bookings
                only.
              </p>
              <table style="width: 100%; border-collapse: collapse">
                <thead>
                  <tr style="border-bottom: 2px solid var(--border)">
                    <th
                      style="padding: 12px; text-align: left; font-weight: 600"
                    >
                      Vehicle Type
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: left;
                        font-weight: 600;
                        color: var(--text-secondary);
                        font-size: 0.9em;
                      "
                    >
                      Includes (Car Models)
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        font-weight: 600;
                      "
                    >
                      Hourly Rate (AED)
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        font-weight: 600;
                      "
                    >
                      3-Hour Total
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        font-weight: 600;
                      "
                    >
                      14-Hour Total
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        font-weight: 600;
                      "
                    >
                      Status
                    </th>
                    <th
                      style="
                        padding: 12px;
                        text-align: center;
                        font-weight: 600;
                      "
                    >
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody id="rentalRulesTableBody">
                  <tr>
                    <td colspan="7" style="text-align: center; padding: 20px">
                      Loading rental rules...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Settings Page -->
          <div id="page-settings" class="page">
            <h2 class="page-title">Settings</h2>
            <div class="card">
              <h3>API Configuration</h3>
              <div class="form-group">
                <label>API Base URL</label>
                <input type="text" id="apiUrl" readonly />
              </div>
              <h3 style="margin-top: 30px">System Information</h3>
              <div class="info-grid">
                <div class="info-item">
                  <span>Dashboard Version</span>
                  <strong>2.1.0</strong>
                </div>
                <div class="info-item">
                  <span>Last Updated</span>
                  <strong id="lastUpdated">--</strong>
                </div>
                <div class="info-item">
                  <span>User</span>
                  <strong id="currentUser">--</strong>
                </div>
              </div>
            </div>
          </div>

          <!-- Alerts Page -->
          <div id="page-alerts" class="page">
            <h2 class="page-title">System Alerts</h2>
            <div class="card">
              <div id="alertsFullList" class="alerts-full-list"></div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Booking Detail Modal -->
    <div id="bookingDetailModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Booking Details</h3>
          <button
            class="modal-close"
            onclick="closeModal('bookingDetailModal')"
          >
            √ó
          </button>
        </div>
        <div class="modal-body" id="bookingDetailContent">Loading...</div>
        <div
          style="
            padding: 15px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
          "
        >
          <button
            onclick="closeModal('bookingDetailModal')"
            class="btn"
            style="background: var(--bg-secondary)"
          >
            Close
          </button>
          <button
            id="detailEditBtn"
            onclick="openDetailEditModal()"
            class="btn btn-primary"
          >
            Edit Booking
          </button>
        </div>
      </div>
    </div>

    <!-- Vehicle Detail Modal -->
    <div id="vehicleDetailModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Vehicle Details</h3>
          <button
            class="modal-close"
            onclick="closeModal('vehicleDetailModal')"
          >
            √ó
          </button>
        </div>
        <div class="modal-body" id="vehicleDetailContent">Loading...</div>
        <div
          style="
            padding: 15px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
          "
        >
          <button
            onclick="closeModal('vehicleDetailModal')"
            class="btn"
            style="background: var(--bg-secondary)"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Booking Modal -->
    <div id="editBookingModal" class="modal" style="display: none">
      <div class="modal-content" style="max-height: 90vh; overflow-y: auto">
        <div class="modal-header">
          <h3>Edit Booking</h3>
          <button class="modal-close" onclick="closeModal('editBookingModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <form id="editBookingForm" style="display: grid; gap: 12px">
            <input type="hidden" id="editBookingId" />
            <div class="form-group">
              <label>Booking Status</label>
              <select
                id="editStatus"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div class="form-group">
              <label>Booking Type</label>
              <select
                id="editBookingType"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="point_to_point">Point to Point</option>
                <option value="airport_transfer">Airport Transfer</option>
                <option value="city_tour">City Tour</option>
                <option value="hourly_rental">Hourly Rental</option>
                <option value="multi_stop">üõ£Ô∏è Multi-Stop</option>
                <option value="round_trip">üîÑ Round Trip</option>
              </select>
            </div>
            <div class="form-group" style="position: relative">
              <label>Pickup Location</label>
              <input
                type="text"
                id="editPickup"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  position: relative;
                  z-index: 5;
                "
              />
              <div
                id="pickupSuggestions"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  background: var(--bg-primary);
                  border: 1px solid var(--border);
                  border-top: none;
                  border-radius: 0 0 6px 6px;
                  max-height: 150px;
                  overflow-y: auto;
                  z-index: 250;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                  display: none;
                "
              ></div>
            </div>
            <div class="form-group" style="position: relative">
              <label>Dropoff Location</label>
              <input
                type="text"
                id="editDropoff"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  position: relative;
                  z-index: 5;
                "
              />
              <div
                id="dropoffSuggestions"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  background: var(--bg-primary);
                  border: 1px solid var(--border);
                  border-top: none;
                  border-radius: 0 0 6px 6px;
                  max-height: 150px;
                  overflow-y: auto;
                  z-index: 250;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                  display: none;
                "
              ></div>
            </div>
            <div
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px"
            >
              <div class="form-group">
                <label>Distance (km)</label>
                <input
                  type="number"
                  id="editDistance"
                  step="0.1"
                  style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid var(--border);
                    border-radius: 6px;
                  "
                  placeholder="Auto-calculated"
                />
              </div>
            </div>
            <div class="form-group">
              <label>Vehicle Type</label>
              <select
                id="editVehicleType"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="sedan">Sedan</option>
                <option value="suv">SUV</option>
                <option value="luxury">Luxury</option>
                <option value="van">Van</option>
                <option value="bus">Bus</option>
                <option value="minibus">Mini Bus</option>
              </select>
            </div>
            <div class="form-group">
              <label>Vehicle Model</label>
              <select
                id="editVehicleModel"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="">-- Select Vehicle Model --</option>
              </select>
            </div>
            <div class="form-group">
              <label>Payment Method</label>
              <select
                id="editPayment"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="cash">Cash</option>
                <option value="card">Card</option>
              </select>
            </div>
            <div class="form-group">
              <label>Fare Amount (AED)</label>
              <input
                type="number"
                id="editFare"
                step="0.01"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              />
            </div>
            <div class="form-group">
              <label>üìù Notes (Special Requests / Observations)</label>
              <textarea
                id="editNotes"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  min-height: 80px;
                  font-family: monospace;
                "
                placeholder="Add any special requests, observations, or notes from Star Skyline Limousine..."
              ></textarea>
              <small
                style="
                  color: var(--text-secondary);
                  display: block;
                  margin-top: 4px;
                "
                >For driver instructions or customer special requests</small
              >
            </div>
            <div class="form-group">
              <label>Assigned Vehicle (Override)</label>
              <select
                id="editAssignedVehicle"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="">-- Auto Select --</option>
              </select>
              <small
                style="
                  color: var(--text-secondary);
                  display: block;
                  margin-top: 4px;
                "
                >Only editable for pending & assigned bookings</small
              >
            </div>
            <div class="form-group">
              <label>Driver Assignment</label>
              <div
                style="
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 8px;
                  margin-bottom: 8px;
                "
              >
                <button
                  type="button"
                  onclick="setAssignmentMode('manual')"
                  id="manualAssignBtn"
                  class="btn"
                  style="background: var(--bg-secondary)"
                >
                  Manual Assign
                </button>
                <button
                  type="button"
                  onclick="setAssignmentMode('auto')"
                  id="autoAssignBtn"
                  class="btn"
                  style="background: #10b981; color: white"
                >
                  Auto Assign
                </button>
              </div>
              <select
                id="editDriver"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  display: none;
                "
              >
                <option value="">-- Select Driver --</option>
              </select>
              <div
                id="autoAssignStatus"
                style="
                  padding: 8px;
                  background: #10b981;
                  color: white;
                  border-radius: 6px;
                  display: none;
                  text-align: center;
                "
              >
                Will auto-assign on save
              </div>
              <small
                style="
                  color: var(--text-secondary);
                  display: block;
                  margin-top: 4px;
                "
                >Only editable for pending & assigned bookings</small
              >
            </div>
            <div
              class="form-group"
              style="
                border: 1px solid var(--border);
                padding: 12px;
                border-radius: 6px;
                background: var(--bg-secondary);
              "
            >
              <label
                style="font-weight: bold; margin-bottom: 8px; display: block"
                >üì¨ Notifications on Save:</label
              >
              <div
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px"
              >
                <div>
                  <p style="margin: 0 0 8px 0; font-weight: 600">Customer</p>
                  <label
                    style="
                      display: flex;
                      align-items: center;
                      gap: 6px;
                      margin-bottom: 6px;
                    "
                  >
                    <input
                      type="checkbox"
                      id="notifyCustomerWhatsApp"
                      style="width: 16px; height: 16px"
                    />
                    <span>WhatsApp</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 6px">
                    <input
                      type="checkbox"
                      id="notifyCustomerEmail"
                      style="width: 16px; height: 16px"
                    />
                    <span>Email</span>
                  </label>
                </div>
                <div>
                  <p style="margin: 0 0 8px 0; font-weight: 600">Driver</p>
                  <label
                    style="
                      display: flex;
                      align-items: center;
                      gap: 6px;
                      margin-bottom: 6px;
                    "
                  >
                    <input
                      type="checkbox"
                      id="notifyDriverWhatsApp"
                      style="width: 16px; height: 16px"
                    />
                    <span>WhatsApp</span>
                  </label>
                  <label style="display: flex; align-items: center; gap: 6px">
                    <input
                      type="checkbox"
                      id="notifyDriverEmail"
                      style="width: 16px; height: 16px"
                    />
                    <span>Email</span>
                  </label>
                </div>
              </div>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%">
              Save Changes
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit Fare Rule Modal -->
    <div id="editFareRuleModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Fare Rule</h3>
          <button class="modal-close" onclick="closeModal('editFareRuleModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <form id="editFareRuleForm" style="display: grid; gap: 15px">
            <input type="hidden" id="editFareRuleType" />
            <div class="form-group">
              <label
                style="font-weight: 600; display: block; margin-bottom: 8px"
                >Vehicle Type</label
              >
              <div
                id="editFareRuleTypeDisplay"
                style="
                  padding: 12px;
                  background: var(--bg-secondary);
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  font-weight: 500;
                "
              ></div>
            </div>
            <div class="form-group">
              <label style="font-weight: 600">Base Fare (AED)</label>
              <input
                type="number"
                id="editFareRuleBase"
                step="0.01"
                min="0"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  font-size: 1em;
                "
                required
              />
            </div>
            <div class="form-group">
              <label style="font-weight: 600">Per KM Rate (AED)</label>
              <input
                type="number"
                id="editFareRulePerKm"
                step="0.01"
                min="0"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  font-size: 1em;
                "
                required
              />
            </div>
            <p
              style="
                color: var(--text-secondary);
                font-size: 13px;
                margin: 10px 0;
              "
            >
              Changes apply only to new bookings created after this update.
            </p>
          </form>
        </div>
        <div
          style="
            padding: 15px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
          "
        >
          <button
            onclick="closeModal('editFareRuleModal')"
            class="btn"
            style="background: var(--bg-secondary)"
          >
            Cancel
          </button>
          <button onclick="saveFareRuleChanges()" class="btn btn-primary">
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Edit Rental Rule Modal -->
    <div id="editRentalRuleModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Hourly Rental Rate</h3>
          <button
            class="modal-close"
            onclick="closeModal('editRentalRuleModal')"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <form id="editRentalRuleForm" style="display: grid; gap: 15px">
            <input type="hidden" id="editRentalVehicleType" />
            <div class="form-group">
              <label
                style="font-weight: 600; display: block; margin-bottom: 8px"
                >Vehicle Type</label
              >
              <div
                id="editRentalTypeDisplay"
                style="
                  padding: 12px;
                  background: var(--bg-secondary);
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  font-weight: 500;
                  text-transform: capitalize;
                "
              ></div>
            </div>
            <div class="form-group">
              <label style="font-weight: 600">Hourly Rate (AED)</label>
              <input
                type="number"
                id="editRentalRate"
                step="0.01"
                min="0"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  font-size: 1em;
                "
                required
              />
            </div>
            <div
              style="
                background: var(--bg-secondary);
                padding: 12px;
                border-radius: 6px;
              "
            >
              <p
                style="margin: 0; font-size: 13px; color: var(--text-secondary)"
              >
                3-hour total: <strong id="calc3Hour">AED 0</strong> | 14-hour
                total: <strong id="calc14Hour">AED 0</strong>
              </p>
            </div>
            <p
              style="
                color: var(--text-secondary);
                font-size: 13px;
                margin: 10px 0;
              "
            >
              Changes apply only to new bookings created after this update.
            </p>
          </form>
        </div>
        <div
          style="
            padding: 15px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
          "
        >
          <button
            onclick="closeModal('editRentalRuleModal')"
            class="btn"
            style="background: var(--bg-secondary)"
          >
            Cancel
          </button>
          <button onclick="saveRentalRuleChanges()" class="btn btn-primary">
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Driver View Modal -->
    <div id="driverViewModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Driver Details</h3>
          <button class="modal-close" onclick="closeModal('driverViewModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <!-- Driver Picture Section -->
          <div style="text-align: center; margin-bottom: 20px">
            <img
              id="driverViewImage"
              src=""
              alt="Driver"
              style="
                width: 120px;
                height: 120px;
                border-radius: 50%;
                object-fit: cover;
                border: 3px solid var(--border);
                background: var(--bg-secondary);
              "
            />
          </div>

          <!-- Driver Info -->
          <div class="form-group">
            <label>Name</label>
            <input
              type="text"
              id="driverViewName"
              readonly
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
                background: var(--bg-secondary);
              "
            />
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input
              type="text"
              id="driverViewPhone"
              readonly
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
                background: var(--bg-secondary);
              "
            />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input
              type="text"
              id="driverViewEmail"
              readonly
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
                background: var(--bg-secondary);
              "
            />
          </div>

          <!-- Status & Rating Section -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px">
            <div class="form-group">
              <label>Status</label>
              <input
                type="text"
                id="driverViewStatus"
                readonly
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  background: var(--bg-secondary);
                "
              />
            </div>
            <div class="form-group">
              <label>Rating</label>
              <input
                type="text"
                id="driverViewRating"
                readonly
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  background: var(--bg-secondary);
                "
              />
            </div>
          </div>

          <!-- License Section -->
          <div class="form-group">
            <label>License Number</label>
            <input
              type="text"
              id="driverViewLicense"
              readonly
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
                background: var(--bg-secondary);
              "
            />
          </div>
          <div class="form-group">
            <label>License Expiry Date</label>
            <input
              type="text"
              id="driverViewLicenseExpiry"
              readonly
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
                background: var(--bg-secondary);
              "
            />
          </div>

          <!-- Auto Assign Section -->
          <div class="form-group">
            <label
              style="
                display: flex;
                align-items: center;
                gap: 8px;
                cursor: pointer;
              "
            >
              <input
                type="checkbox"
                id="driverViewAutoAssign"
                disabled
                style="width: 18px; height: 18px; cursor: not-allowed"
              />
              <span>Auto Assign Enabled</span>
            </label>
          </div>

          <button
            onclick="closeModal('driverViewModal')"
            class="btn"
            style="width: 100%"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Driver Edit Modal -->
    <div id="driverEditModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Driver</h3>
          <button class="modal-close" onclick="closeModal('driverEditModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="driverEditId" />
          <div class="form-group">
            <label>Name</label>
            <input
              type="text"
              id="driverName"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input
              type="text"
              id="driverPhone"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input
              type="text"
              id="driverEmail"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label>Status</label>
            <select
              id="driverStatus"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            >
              <option value="online">Online</option>
              <option value="offline">Offline</option>
            </select>
          </div>

          <!-- Auto Assign Checkbox -->
          <div class="form-group">
            <label
              style="
                display: flex;
                align-items: center;
                gap: 8px;
                cursor: pointer;
              "
            >
              <input
                type="checkbox"
                id="driverAutoAssign"
                style="width: 18px; height: 18px; cursor: pointer"
              />
              <span>Enable Auto Assign</span>
            </label>
            <small
              style="
                color: var(--text-secondary);
                display: block;
                margin-top: 4px;
              "
              >If unchecked, this driver will NOT be auto-assigned to
              bookings</small
            >
          </div>

          <button
            onclick="saveDriverChanges()"
            class="btn btn-primary"
            style="width: 100%"
          >
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Vehicle Edit Modal -->
    <div id="vehicleEditModal" class="modal" style="display: none">
      <div class="modal-content" style="max-height: 85vh; overflow-y: auto">
        <div class="modal-header">
          <h3>‚úèÔ∏è Edit Vehicle</h3>
          <button class="modal-close" onclick="closeModal('vehicleEditModal')">
            √ó
          </button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="vehicleEditId" />
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div class="form-group">
              <label>üöó Model</label>
              <input
                type="text"
                id="vehicleModel"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                required
              />
            </div>
            <div class="form-group">
              <label>üìç Plate Number</label>
              <input
                type="text"
                id="vehiclePlate"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                required
              />
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div class="form-group">
              <label>üé® Color <span style="color: red">*</span></label>
              <select
                id="vehicleColor"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                required
              >
                <option value="">-- Select Color --</option>
                <option value="Black">Black</option>
                <option value="White">White</option>
                <option value="Silver">Silver</option>
                <option value="Gray">Gray</option>
                <option value="Red">Red</option>
                <option value="Blue">Blue</option>
                <option value="Gold">Gold</option>
              </select>
            </div>
            <div class="form-group">
              <label>üìã Type</label>
              <select
                id="vehicleType"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="sedan">Sedan</option>
                <option value="suv">SUV</option>
                <option value="luxury">Luxury</option>
                <option value="van">Van</option>
                <option value="bus">Bus</option>
                <option value="minibus">Mini Bus</option>
              </select>
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div class="form-group">
              <label>‚úÖ Status</label>
              <select
                id="vehicleStatus"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              >
                <option value="available">Available</option>
                <option value="on_duty">On Duty</option>
                <option value="maintenance">Maintenance</option>
              </select>
            </div>
            <div class="form-group">
              <label>üë• Max Passengers</label>
              <input
                type="number"
                id="vehiclePassengers"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                min="1"
                max="9"
              />
            </div>
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px">
            <div class="form-group">
              <label>üß≥ Max Luggage</label>
              <input
                type="number"
                id="vehicleLuggage"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                min="0"
                max="10"
              />
            </div>
            <div class="form-group">
              <label>üí∞ Hourly Rate (AED)</label>
              <input
                type="number"
                id="vehicleHourly"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                step="0.01"
                min="0"
              />
            </div>
          </div>
          <div class="form-group">
            <label>üìè Per KM Rate (AED)</label>
            <input
              type="number"
              id="vehiclePerKm"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
              step="0.01"
              min="0"
            />
          </div>
          <div class="form-group">
            <label>üë®‚Äç‚úàÔ∏è Assign Driver (Company Vehicles)</label>
            <select
              id="vehicleDriver"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            >
              <option value="">-- No Driver --</option>
            </select>
            <small
              style="
                color: var(--text-secondary);
                display: block;
                margin-top: 4px;
              "
              >Select a driver to assign to this vehicle</small
            >
          </div>
          <button
            onclick="saveVehicleChanges()"
            class="btn btn-primary"
            style="width: 100%; padding: 12px; font-size: 1em; margin-top: 10px"
          >
            üíæ Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Add Booking Modal -->
    <div id="addBookingModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create Booking</h3>
          <button class="modal-close" onclick="closeModal('addBookingModal')">
            √ó
          </button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto">
          <div class="form-group">
            <label>Customer Name</label>
            <input
              type="text"
              id="bookingCustomerName"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label>Email</label>
            <input
              type="email"
              id="bookingCustomerEmail"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input
              type="text"
              id="bookingCustomerPhone"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label style="font-weight: 600; color: #2563eb"
              >üìç Booking Type (Select First)</label
            >
            <select
              id="bookingType"
              onchange="toggleBookingTypeFields()"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            >
              <option value="">-- Select Booking Type --</option>
              <option value="point_to_point">Point to Point</option>
              <option value="airport_transfer">‚úàÔ∏è Airport Transfer</option>
              <option value="hourly_rental">
                ‚è∞ Hourly Rental (3-14 hours)
              </option>
              <option value="multi_stop">
                üõ£Ô∏è Multi-Stop (Multiple Locations)
              </option>
              <option value="round_trip">üîÑ Round Trip (Return Journey)</option>
            </select>
          </div>
          <div id="locationFieldsWrapper" style="display: none">
            <div class="form-group" style="position: relative">
              <label>Pickup Location</label>
              <input
                type="text"
                id="bookingPickup"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  position: relative;
                  z-index: 5;
                "
              />
              <div
                id="addPickupSuggestions"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  background: var(--bg-primary);
                  border: 1px solid var(--border);
                  border-top: none;
                  border-radius: 0 0 6px 6px;
                  max-height: 150px;
                  overflow-y: auto;
                  z-index: 250;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                  display: none;
                "
              ></div>
            </div>
            <div class="form-group" style="position: relative">
              <label>Dropoff Location</label>
              <input
                type="text"
                id="bookingDropoff"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  position: relative;
                  z-index: 5;
                "
              />
              <div
                id="addDropoffSuggestions"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  background: var(--bg-primary);
                  border: 1px solid var(--border);
                  border-top: none;
                  border-radius: 0 0 6px 6px;
                  max-height: 150px;
                  overflow-y: auto;
                  z-index: 250;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                  display: none;
                "
              ></div>
            </div>
            <div
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px"
            >
              <div class="form-group">
                <label>üïê Pickup Time</label>
                <input
                  type="datetime-local"
                  id="bookingPickupTime"
                  style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid var(--border);
                    border-radius: 6px;
                  "
                />
              </div>
              <div class="form-group">
                <label>Distance (km)</label>
                <input
                  type="number"
                  id="bookingDistance"
                  step="0.1"
                  style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid var(--border);
                    border-radius: 6px;
                  "
                  placeholder="Auto-calculated"
                />
              </div>
              <div class="form-group">
                <label>Fare (AED)</label>
                <input
                  type="number"
                  id="bookingFare"
                  step="0.01"
                  style="
                    width: 100%;
                    padding: 8px;
                    border: 1px solid var(--border);
                    border-radius: 6px;
                  "
                  placeholder="Auto-calculated"
                />
              </div>
            </div>
          </div>
          <div id="hourlyRentalFieldsWrapper" style="display: none">
            <div class="form-group" style="position: relative">
              <label>Meeting Location</label>
              <input
                type="text"
                id="bookingHourlyLocation"
                placeholder="Where customer will be picked up"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  position: relative;
                  z-index: 5;
                "
              />
              <div
                id="addHourlyLocationSuggestions"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  background: var(--bg-primary);
                  border: 1px solid var(--border);
                  border-top: none;
                  border-radius: 0 0 6px 6px;
                  max-height: 150px;
                  overflow-y: auto;
                  z-index: 250;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                  display: none;
                "
              ></div>
            </div>
            <div class="form-group">
              <label>Rental Hours</label>
              <input
                type="number"
                id="bookingHourlyHours"
                value="3"
                step="0.5"
                min="3"
                max="14"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                placeholder="3-14 hours"
              />
            </div>
            <div class="form-group">
              <label>Estimated Fare (AED)</label>
              <input
                type="number"
                id="bookingHourlyFare"
                step="0.01"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
                placeholder="Auto-calculated"
                readonly
              />
            </div>
          </div>
          <div class="form-group">
            <label>Passengers</label>
            <input
              type="number"
              id="bookingPassengers"
              value="1"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label>Luggage</label>
            <input
              type="number"
              id="bookingLuggage"
              value="0"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            />
          </div>
          <div class="form-group">
            <label>üé® Vehicle Color (Optional)</label>
            <select
              id="bookingVehicleColor"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            >
              <option value="">-- Select Color --</option>
              <option value="Black">Black</option>
              <option value="White">White</option>
              <option value="Silver">Silver</option>
              <option value="Gray">Gray</option>
              <option value="Red">Red</option>
              <option value="Blue">Blue</option>
              <option value="Gold">Gold</option>
            </select>
          </div>
          <div
            id="multiStopFields"
            style="
              display: none;
              border: 1px solid #3b82f6;
              padding: 12px;
              border-radius: 6px;
              background: #eff6ff;
              margin-bottom: 12px;
            "
          >
            <label style="font-weight: 600; display: block; margin-bottom: 8px"
              >üìç Additional Stops</label
            >
            <div id="stopsContainer"></div>
            <button
              type="button"
              onclick="addStopField()"
              class="btn"
              style="
                width: 100%;
                background: #3b82f6;
                color: white;
                margin-top: 8px;
              "
            >
              + Add Stop
            </button>
          </div>
          <div
            id="roundTripFields"
            style="
              display: none;
              border: 1px solid #8b5cf6;
              padding: 12px;
              border-radius: 6px;
              background: #faf5ff;
              margin-bottom: 12px;
            "
          >
            <label style="font-weight: 600; display: block; margin-bottom: 8px"
              >üåç Return Location & Hours</label
            >
            <div class="form-group" style="position: relative">
              <label>Meeting Location</label>
              <input
                type="text"
                id="roundTripMeetingLocation"
                placeholder="Where customer goes"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                  position: relative;
                  z-index: 5;
                "
              />
              <div
                id="roundTripMeetingSuggestions"
                style="
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  background: var(--bg-primary);
                  border: 1px solid var(--border);
                  border-top: none;
                  border-radius: 0 0 6px 6px;
                  max-height: 150px;
                  overflow-y: auto;
                  z-index: 250;
                  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                  display: none;
                "
              ></div>
            </div>
            <div class="form-group">
              <label>Return After (Hours)</label>
              <input
                type="number"
                id="roundTripHours"
                value="3"
                step="0.5"
                min="1"
                placeholder="e.g., 3 hours"
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border);
                  border-radius: 6px;
                "
              />
            </div>
          </div>
          <div class="form-group">
            <label>Vehicle Type</label>
            <select
              id="bookingVehicleType"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            >
              <option value="sedan">Sedan</option>
              <option value="suv">SUV</option>
              <option value="luxury">Luxury</option>
              <option value="van">Van</option>
              <option value="bus">Bus</option>
              <option value="minibus">Mini Bus</option>
            </select>
          </div>
          <div class="form-group">
            <label>Vehicle Model</label>
            <select
              id="bookingVehicleModel"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            >
              <option value="">-- Select Vehicle Model --</option>
            </select>
          </div>
          <div class="form-group">
            <label>Payment Method</label>
            <select
              id="bookingPayment"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
              "
            >
              <option value="cash">Cash</option>
              <option value="card">Card</option>
            </select>
          </div>
          <div class="form-group">
            <label>Driver Assignment</label>
            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 8px;
                margin-bottom: 8px;
              "
            >
              <button
                type="button"
                onclick="setCreateAssignmentMode('manual')"
                id="createManualAssignBtn"
                class="btn"
                style="background: var(--bg-secondary)"
              >
                Manual Assign
              </button>
              <button
                type="button"
                onclick="setCreateAssignmentMode('auto')"
                id="createAutoAssignBtn"
                class="btn"
                style="background: #10b981; color: white"
              >
                Auto Assign
              </button>
            </div>
            <select
              id="createDriver"
              style="
                width: 100%;
                padding: 8px;
                border: 1px solid var(--border);
                border-radius: 6px;
                display: none;
              "
            >
              <option value="">-- Select Driver --</option>
            </select>
            <div
              id="createAutoAssignStatus"
              style="
                padding: 8px;
                background: #10b981;
                color: white;
                border-radius: 6px;
                display: none;
                text-align: center;
              "
            >
              Will auto-assign on save
            </div>
          </div>
          <button
            onclick="createManualBooking()"
            class="btn btn-primary"
            style="width: 100%"
          >
            Create Booking
          </button>
        </div>
      </div>
    </div>

    <!-- Vendor Details Modal -->
    <div
      id="vendorModal"
      class="modal"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 90%;
        z-index: 10000;
        max-height: 80vh;
        overflow-y: auto;
      "
    >
      <h3 style="margin-top: 0">Vendor Details</h3>
      <div style="display: grid; gap: 12px; margin: 20px 0">
        <div><strong>Company Name:</strong> <span id="vendorName">-</span></div>
        <div><strong>Email:</strong> <span id="vendorEmail">-</span></div>
        <div><strong>Phone:</strong> <span id="vendorPhone">-</span></div>
        <div><strong>Status:</strong> <span id="vendorStatus">-</span></div>
        <div>
          <strong>Total Vehicles:</strong> <span id="vendorVehicles">-</span>
        </div>
        <div>
          <strong>Total Earnings:</strong> <span id="vendorEarnings">-</span>
        </div>
        <div>
          <strong>Completed Bookings:</strong>
          <span id="vendorBookings">-</span>
        </div>
        <div
          style="
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
          "
        >
          <strong>Auto-Assignment Status:</strong>
          <div
            style="
              margin-top: 10px;
              display: flex;
              align-items: center;
              gap: 10px;
            "
          >
            <span id="vendorAutoAssignText" style="flex: 1">‚úÖ Enabled</span>
            <button
              id="toggleAutoAssignBtn"
              onclick="toggleVendorAutoAssign()"
              class="btn"
              style="
                padding: 8px 15px;
                background: #10b981;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
              "
            >
              Toggle
            </button>
          </div>
        </div>
      </div>
      <div
        style="
          display: flex;
          gap: 10px;
          margin-top: 20px;
          justify-content: flex-end;
        "
      >
        <button
          onclick="closeVendorModal()"
          class="btn"
          style="
            padding: 10px 20px;
            background: #ccc;
            color: black;
            border: none;
            border-radius: 6px;
            cursor: pointer;
          "
        >
          Close
        </button>
      </div>
    </div>

    <!-- Modal Overlay -->
    <div
      id="modalOverlay"
      class="modal-overlay"
      style="display: none"
      onclick="closeModal()"
    ></div>
    <div
      id="vendorModalOverlay"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
      "
      onclick="closeVendorModal()"
    ></div>

    <!-- Toast Notification Container -->
    <div
      id="toastContainer"
      style="
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        pointer-events: none;
      "
    ></div>

    <script src="js/app.js?v=20251210"></script>
    <script>
      // Force cache busting
      if (window.location.hash === "") {
        window.location.hash = Math.random().toString(36).substring(2, 15);
        window.location.reload();
      }
    </script>
  </body>
</html>

<!-- Logs Page -->
<div id="page-logs" class="page" style="display: none">
  <h2 class="page-title">üìã Activity Logs</h2>
  <div class="filter-bar">
    <input
      type="text"
      id="log-search"
      placeholder="üîç Search..."
      class="filter-select"
      style="flex: 1"
    />
    <select id="log-entity-filter" class="filter-select">
      <option value="">All Entities</option>
      <option value="vehicle">Vehicles</option>
      <option value="driver">Drivers</option>
    </select>
    <select id="log-action-filter" class="filter-select">
      <option value="">All Actions</option>
      <option value="UPDATE">Update</option>
      <option value="CREATE">Create</option>
    </select>
  </div>
  <div class="card">
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Action</th>
            <th>Entity</th>
            <th>ID</th>
            <th>Updated By</th>
            <th>Role</th>
            <th>Changes</th>
          </tr>
        </thead>
        <tbody id="logs-table-body">
          <tr>
            <td colspan="7">Loading...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
