<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bareerah Admin Dashboard</title>
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>
<body>
  <div class="container">
    <!-- Titlebar -->
    <div class="titlebar">
      <h1>Bareerah Admin</h1>
      <div class="titlebar-right">
        <button class="theme-toggle" id="themeToggle">üåô</button>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Sidebar -->
      <aside class="sidebar">
        <a class="nav-item active" data-page="dashboard">üìä Dashboard</a>
        <a class="nav-item" data-page="kpi">üíπ KPI & Profits</a>
        <a class="nav-item" data-page="bookings">üìÖ Bookings</a>
        <div class="nav-submenu-toggle" onclick="toggleSubmenu(this)">üë• Drivers ‚ñº</div>
        <div class="nav-submenu" style="display: none;">
          <a class="nav-item" data-page="drivers-all">All Drivers</a>
          <a class="nav-item" data-page="drivers-online">Online</a>
          <a class="nav-item" data-page="drivers-offline">Offline</a>
        </div>
        <div class="nav-submenu-toggle" onclick="toggleSubmenu(this)">üöó Cars ‚ñº</div>
        <div class="nav-submenu" style="display: none;">
          <a class="nav-item" data-page="cars-all">All Cars</a>
          <a class="nav-item" data-page="cars-sedan">Sedan</a>
          <a class="nav-item" data-page="cars-suv">SUV</a>
          <a class="nav-item" data-page="cars-luxury">Luxury</a>
          <a class="nav-item" data-page="cars-van">Van</a>
        </div>
        <a class="nav-item" data-page="fares">üí∞ Fare Rules</a>
        <a class="nav-item" data-page="settings">‚öôÔ∏è Settings</a>
        <a class="nav-item" data-page="alerts">üö® Alerts</a>
      </aside>

      <!-- Content Area -->
      <main class="content">
        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page active">
          <h2 class="page-title">Dashboard</h2>
          
          <!-- Filter Controls -->
          <div class="filter-bar">
            <div class="filter-group">
              <button class="filter-btn active" data-range="today">Today</button>
              <button class="filter-btn" data-range="yesterday">Yesterday</button>
              <button class="filter-btn" data-range="week">This Week</button>
              <button class="filter-btn" data-range="month">This Month</button>
              <button class="filter-btn" data-range="custom">Custom Range</button>
            </div>
            <div class="date-picker" style="display: none;" id="customDatePicker">
              <input type="date" id="startDate">
              <span>to</span>
              <input type="date" id="endDate">
              <button class="btn btn-small btn-primary" onclick="applyCustomRange()">Apply</button>
            </div>
          </div>

          <!-- Summary Cards -->
          <div class="stats-grid">
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Bookings</div>
                <span class="stat-icon">üìä</span>
              </div>
              <div class="stat-value" id="stat-bookings">0</div>
              <div class="stat-subtitle">in selected period</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Completed</div>
                <span class="stat-icon">‚úÖ</span>
              </div>
              <div class="stat-value" id="stat-completed">0</div>
              <div class="stat-subtitle">successful rides</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Pending</div>
                <span class="stat-icon">‚è≥</span>
              </div>
              <div class="stat-value" id="stat-pending">0</div>
              <div class="stat-subtitle">awaiting completion</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Cancelled</div>
                <span class="stat-icon">‚ùå</span>
              </div>
              <div class="stat-value" id="stat-cancelled">0</div>
              <div class="stat-subtitle">cancelled rides</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Revenue</div>
                <span class="stat-icon">üí∞</span>
              </div>
              <div class="stat-value" id="stat-revenue">AED 0</div>
              <div class="stat-subtitle">completed bookings</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Cash vs Card</div>
                <span class="stat-icon">üí≥</span>
              </div>
              <div class="stat-split">
                <div class="split-item">
                  <span>Cash:</span>
                  <span id="stat-cash">AED 0</span>
                </div>
                <div class="split-item">
                  <span>Card:</span>
                  <span id="stat-card">AED 0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts Section -->
          <div class="charts-container">
            <div class="chart-card">
              <h3>7-Day Booking Trend</h3>
              <canvas id="bookingsChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Revenue by Vehicle Type</h3>
              <canvas id="revenueChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Top Drivers</h3>
              <div id="driversStats" class="drivers-list"></div>
            </div>
          </div>

          <!-- Alerts Panel -->
          <div class="alerts-panel">
            <h3>System Alerts</h3>
            <div id="alertsList" class="alerts-list"></div>
          </div>
        </div>

        <!-- KPI & Profits Page -->
        <div id="page-kpi" class="page">
          <h2 class="page-title">KPI & Profits Dashboard</h2>
          
          <div class="filter-bar">
            <div class="filter-group">
              <button class="filter-btn active" data-range="today" onclick="loadKPI()">Today</button>
              <button class="filter-btn" data-range="yesterday" onclick="loadKPI()">Yesterday</button>
              <button class="filter-btn" data-range="week" onclick="loadKPI()">This Week</button>
              <button class="filter-btn" data-range="month" onclick="loadKPI()">This Month</button>
            </div>
          </div>

          <!-- KPI Cards -->
          <div class="stats-grid">
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Revenue</div>
                <span class="stat-icon">üí∞</span>
              </div>
              <div class="stat-value" id="kpi-total-revenue">AED 0</div>
              <div class="stat-subtitle">total earnings</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Vendor Commission</div>
                <span class="stat-icon">üè¢</span>
              </div>
              <div class="stat-value" id="kpi-vendor-commission">AED 0</div>
              <div class="stat-subtitle">paid to vendors</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Net Company Profit</div>
                <span class="stat-icon">üìà</span>
              </div>
              <div class="stat-value" id="kpi-company-profit">AED 0</div>
              <div class="stat-subtitle">our earnings</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Profit Margin</div>
                <span class="stat-icon">üìä</span>
              </div>
              <div class="stat-value" id="kpi-profit-margin">0%</div>
              <div class="stat-subtitle">company profit %</div>
            </div>
          </div>

          <!-- Charts -->
          <div class="charts-container">
            <div class="chart-card">
              <h3>Earnings Breakdown by Timeframe</h3>
              <canvas id="earningsChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Company vs Vendor Earnings</h3>
              <canvas id="companyVendorChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Top Vendors by Revenue</h3>
              <div id="topVendorsList" class="vendors-list"></div>
            </div>
          </div>
        </div>

        <!-- Bookings Page -->
        <div id="page-bookings" class="page">
          <h2 class="page-title">Bookings</h2>
          
          <div class="filter-bar">
            <div class="filter-group">
              <button class="filter-btn active" data-range="today">Today</button>
              <button class="filter-btn" data-range="yesterday">Yesterday</button>
              <button class="filter-btn" data-range="week">Week</button>
              <button class="filter-btn" data-range="month">Month</button>
            </div>
            <div class="search-box">
              <input type="text" id="bookingSearch" placeholder="Search by name, phone, or location...">
            </div>
            <div class="filter-dropdowns">
              <select id="statusFilter">
                <option value="">All Status</option>
                <option value="pending">Pending</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
              <select id="vehicleFilter">
                <option value="">All Vehicles</option>
                <option value="sedan">Sedan</option>
                <option value="suv">SUV</option>
                <option value="luxury">Luxury</option>
                <option value="van">Van</option>
              </select>
            </div>
            <button class="btn btn-primary" onclick="exportBookings('csv')">üì• Export CSV</button>
          </div>

          <div class="card">
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Booking ID</th>
                    <th>Customer</th>
                    <th>Phone</th>
                    <th>Pickup</th>
                    <th>Drop</th>
                    <th>Distance (km)</th>
                    <th>Vehicle</th>
                    <th>Fare</th>
                    <th>Driver</th>
                    <th>Payment</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="bookings-table-body">
                  <tr><td colspan="13" style="text-align: center; color: var(--text-secondary);">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Drivers Pages -->
        <div id="page-drivers-all" class="page">
          <h2 class="page-title">Drivers</h2>
          <div class="card">
            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Car Assigned</th>
                    <th>Total Trips</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="drivers-table-body">
                  <tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">Loading...</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Cars Pages -->
        <div id="page-cars-all" class="page">
          <h2 class="page-title">Vehicles</h2>
          <div class="card">
            <div class="table-container" id="carsGrid">
              <p>Loading...</p>
            </div>
          </div>
        </div>

        <!-- Fare Rules Page -->
        <div id="page-fares" class="page">
          <h2 class="page-title">Fare Rules Configuration</h2>
          <div class="card">
            <form id="fareForm">
              <div class="form-grid">
                <div class="form-group">
                  <label>Base Fare (AED)</label>
                  <input type="number" id="baseFare" value="5" step="0.01">
                </div>
                <div class="form-group">
                  <label>Per Km Rate - Sedan (AED)</label>
                  <input type="number" id="sedanKmRate" value="3.5" step="0.01">
                </div>
                <div class="form-group">
                  <label>Per Km Rate - SUV (AED)</label>
                  <input type="number" id="suvKmRate" value="4.5" step="0.01">
                </div>
                <div class="form-group">
                  <label>Per Km Rate - Luxury (AED)</label>
                  <input type="number" id="luxuryKmRate" value="6.5" step="0.01">
                </div>
              </div>
              <button type="submit" class="btn btn-primary">Save Fare Rules</button>
            </form>
          </div>
        </div>

        <!-- Settings Page -->
        <div id="page-settings" class="page">
          <h2 class="page-title">Settings</h2>
          <div class="card">
            <h3>API Configuration</h3>
            <div class="form-group">
              <label>API Base URL</label>
              <input type="text" id="apiUrl" readonly>
            </div>
            <h3 style="margin-top: 30px;">System Information</h3>
            <div class="info-grid">
              <div class="info-item">
                <span>Dashboard Version</span>
                <strong>2.1.0</strong>
              </div>
              <div class="info-item">
                <span>Last Updated</span>
                <strong id="lastUpdated">--</strong>
              </div>
              <div class="info-item">
                <span>User</span>
                <strong id="currentUser">--</strong>
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts Page -->
        <div id="page-alerts" class="page">
          <h2 class="page-title">System Alerts</h2>
          <div class="card">
            <div id="alertsFullList" class="alerts-full-list"></div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Booking Detail Modal -->
  <div id="bookingDetailModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Booking Details</h3>
        <button class="modal-close" onclick="closeModal('bookingDetailModal')">√ó</button>
      </div>
      <div class="modal-body" id="bookingDetailContent">
        Loading...
      </div>
    </div>
  </div>

  <!-- Edit Booking Modal -->
  <div id="editBookingModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Booking</h3>
        <button class="modal-close" onclick="closeModal('editBookingModal')">√ó</button>
      </div>
      <div class="modal-body">
        <form id="editBookingForm">
          <div class="form-group">
            <label>Status</label>
            <select id="editStatus">
              <option value="pending">Pending</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
          <div class="form-group">
            <label>Payment Method</label>
            <select id="editPayment">
              <option value="cash">Cash</option>
              <option value="card">Card</option>
            </select>
          </div>
          <div class="form-group">
            <label>Fare Amount (AED)</label>
            <input type="number" id="editFare" step="0.01">
          </div>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal Overlay -->
  <div id="modalOverlay" class="modal-overlay" style="display: none;" onclick="closeAllModals()"></div>

  <script src="js/app.js"></script>
</body>
</html>
