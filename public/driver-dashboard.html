<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>Driver Dashboard - Star Skyline Limousine</title>
  <link rel="stylesheet" href="dashboard/css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
</head>

<body>
  <div class="container">
    <div class="titlebar">
      <h1>üöó Driver Dashboard</h1>
      <div class="titlebar-right">
        <button class="theme-toggle" id="themeToggle">üåô</button>
        <button class="cache-clear-btn" onclick="clearCacheNow()" title="Clear cache to see latest data">üîÑ Clear
          Cache</button>
        <button class="logout-btn" onclick="driverLogout()">Logout</button>
      </div>
    </div>

    <div class="main-content">
      <aside class="sidebar">
        <a class="nav-item active" data-page="overview">üìä Dashboard</a>
        <a class="nav-item" data-page="bookings">üìÖ Bookings</a>
        <a class="nav-item" data-page="vehicle">üöó My Vehicle</a>
        <a class="nav-item" data-page="earnings">üí∞ Earnings</a>
        <a class="nav-item" data-page="profile">‚öôÔ∏è Profile</a>
      </aside>

      <div class="content">
        <!-- Dashboard Page -->
        <div id="page-overview" class="page active">
          <h2>üìä Dashboard</h2>

          <!-- Filter Controls -->
          <div class="filter-bar" style="margin-bottom: 20px;">
            <div class="filter-group">
              <button class="filter-btn active"
                onclick="setDateRange('today'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">Today</button>
              <button class="filter-btn"
                onclick="setDateRange('yesterday'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">Yesterday</button>
              <button class="filter-btn"
                onclick="setDateRange('week'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">This
                Week</button>
              <button class="filter-btn"
                onclick="setDateRange('month'); this.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('active')); this.classList.add('active');">This
                Month</button>
              <button class="filter-btn" onclick="toggleCustomRange()">Custom Range</button>
            </div>
            <div class="date-picker" style="display: none;" id="customDatePicker">
              <input type="date" id="startDate">
              <span>to</span>
              <input type="date" id="endDate">
              <button class="btn btn-small btn-primary" onclick="applyCustomRange()">Apply</button>
            </div>
          </div>

          <!-- Stats Cards -->
          <div class="stats-grid">
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Bookings</div>
                <span class="stat-icon">üìä</span>
              </div>
              <div class="stat-value" id="stat-bookings">0</div>
              <div class="stat-subtitle">in selected period</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Completed</div>
                <span class="stat-icon">‚úÖ</span>
              </div>
              <div class="stat-value" id="stat-completed">0</div>
              <div class="stat-subtitle">successful rides</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Total Earnings</div>
                <span class="stat-icon">üí∞</span>
              </div>
              <div class="stat-value" id="stat-earnings">AED 0</div>
              <div class="stat-subtitle">in selected period</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-header">
                <div class="stat-label">Avg Rating</div>
                <span class="stat-icon">‚≠ê</span>
              </div>
              <div class="stat-value" id="stat-rating">0</div>
              <div class="stat-subtitle">from riders</div>
            </div>
          </div>

          <!-- Charts -->
          <div class="charts-container" style="margin-top: 30px;">
            <div class="chart-card">
              <h3>7-Day Booking Trend</h3>
              <canvas id="bookingsChart"></canvas>
            </div>
            <div class="chart-card">
              <h3>Earnings Breakdown</h3>
              <canvas id="earningsChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Bookings Page -->
        <div id="page-bookings" class="page" style="display: none;">
          <h2>üìÖ My Bookings</h2>
          <table class="table" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
            <thead>
              <tr style="background: var(--glass-bg);">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border-color);">Date</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border-color);">Passenger
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border-color);">Route</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border-color);">Fare (AED)
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border-color);">Status</th>
              </tr>
            </thead>
            <tbody id="bookings-table-body">
              <tr>
                <td colspan="5" style="text-align: center; padding: 20px;">Loading...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Vehicle Page -->
        <div id="page-vehicle" class="page" style="display: none;">
          <h2>üöó My Vehicle</h2>
          <div id="vehicleDetails"
            style="background: var(--glass-bg); padding: 30px; border-radius: 12px; margin-top: 20px;"></div>
        </div>

        <!-- Earnings Page -->
        <div id="page-earnings" class="page" style="display: none;">
          <h2>üí∞ Earnings & Payouts</h2>

          <div class="stats-grid" style="margin-bottom: 30px;">
            <div class="stat-card glass">
              <div class="stat-label">Total Earnings</div>
              <div class="stat-value" id="earn-total">AED 0</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-label">Last Payout</div>
              <div class="stat-value" id="earn-last-payout">AED 0</div>
              <div class="stat-subtitle" id="earn-last-date">No payout yet</div>
            </div>
            <div class="stat-card glass">
              <div class="stat-label">Pending Payout</div>
              <div class="stat-value" id="earn-pending">AED 0</div>
            </div>
          </div>

          <div style="background: var(--glass-bg); padding: 20px; border-radius: 12px; margin-top: 20px;">
            <h3 style="margin-bottom: 20px;">Payout History</h3>
            <table class="table" style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: rgba(0,0,0,0.05);">
                  <th style="padding: 12px; text-align: left;">Date</th>
                  <th style="padding: 12px; text-align: left;">Amount (AED)</th>
                  <th style="padding: 12px; text-align: left;">Status</th>
                </tr>
              </thead>
              <tbody id="payouts-table-body">
                <tr>
                  <td colspan="3" style="text-align: center; padding: 20px;">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Profile Page -->
        <div id="page-profile" class="page" style="display: none;">
          <h2>‚öôÔ∏è My Profile</h2>
          <div
            style="background: var(--glass-bg); padding: 30px; border-radius: 12px; max-width: 600px; margin-top: 20px;">
            <form id="profileForm" style="display: grid; gap: 20px;">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">üë§ Name</label>
                <input type="text" id="profileName" disabled
                  style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(0,0,0,0.1);">
              </div>
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">üìß Email</label>
                <input type="email" id="profileEmail" disabled
                  style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(0,0,0,0.1);">
              </div>
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">üìû Phone</label>
                <input type="text" id="profilePhone" disabled
                  style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(0,0,0,0.1);">
              </div>
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">üìã License Number</label>
                <input type="text" id="profileLicense" disabled
                  style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(0,0,0,0.1);">
              </div>
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 600;">üìä Status</label>
                <input type="text" id="profileStatus" disabled
                  style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: rgba(0,0,0,0.1);">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = window.location.origin + '/api';
    let currentDateRange = 'today';
    let bookingsChart = null;
    let earningsChart = null;

    function checkDriverAuth() {
      const token = localStorage.getItem('driver_token');
      if (!token) window.location.href = '/driver-login.html';
    }

    function driverLogout() {
      localStorage.removeItem('driver_token');
      localStorage.removeItem('driver');
      window.location.href = '/driver-login.html';
    }

    function showToast(message, type = 'success') {
      const container = document.getElementById('driverToastContainer');
      const toast = document.createElement('div');
      toast.style.cssText = `
        background: ${type === 'success' ? '#34C759' : type === 'error' ? '#FF3B30' : '#007AFF'};
        color: white;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 500;
        animation: slideIn 0.3s ease;
        backdrop-filter: blur(12px);
      `;
      const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
      toast.innerHTML = `<span>${icons[type] || icons.success}</span><span>${message}</span>`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => toast.remove(), 300);
      }, 3500);
    }

    function clearCacheNow() {
      localStorage.clear();
      sessionStorage.clear();
      if ('caches' in window) {
        caches.keys().then(names => names.forEach(name => caches.delete(name)));
      }
      showToast('Cache cleared! Refreshing page...', 'success');
      setTimeout(() => location.reload(), 1500);
    }

    function setDateRange(range) {
      currentDateRange = range;
      loadDashboardStats();
      loadBookings();
    }

    function toggleCustomRange() {
      const picker = document.getElementById('customDatePicker');
      picker.style.display = picker.style.display === 'none' ? 'flex' : 'none';
    }

    function applyCustomRange() {
      const start = document.getElementById('startDate').value;
      const end = document.getElementById('endDate').value;
      if (start && end) {
        currentDateRange = `custom_${start}_${end}`;
        loadDashboardStats();
        loadBookings();
      }
    }

    function toggleTheme() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
    }

    async function loadDashboardStats() {
      const token = localStorage.getItem('driver_token');
      try {
        const response = await fetch(`${API_BASE}/driver-stats/summary?range=${currentDateRange}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const result = await response.json();
        if (result.success) {
          const data = result.data;
          document.getElementById('stat-bookings').textContent = data.total_bookings || 0;
          document.getElementById('stat-completed').textContent = data.completed_bookings || 0;
          document.getElementById('stat-earnings').textContent = 'AED ' + parseFloat(data.total_earnings || 0).toFixed(2);
          document.getElementById('stat-rating').textContent = (parseFloat(data.avg_rating || 0)).toFixed(1) + ' ‚≠ê';
          loadCharts();
        }
      } catch (error) {
        console.error('Stats error:', error);
      }
    }

    async function loadCharts() {
      const token = localStorage.getItem('driver_token');
      try {
        const response = await fetch(`${API_BASE}/driver-stats/trends?range=${currentDateRange}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const result = await response.json();
        if (result.success) {
          const data = result.data;
          drawBookingsChart(data.bookings_by_day || []);
          drawEarningsChart(data.earnings_by_status || {});
        }
      } catch (error) {
        console.error('Trends error:', error);
      }
    }

    function drawBookingsChart(data) {
      const ctx = document.getElementById('bookingsChart');
      if (!ctx) return;

      if (bookingsChart) bookingsChart.destroy();

      bookingsChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: data.map(d => d.date) || [],
          datasets: [{
            label: 'Bookings',
            data: data.map(d => d.count) || [],
            borderColor: '#007AFF',
            backgroundColor: 'rgba(0, 122, 255, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: { legend: { display: true } }
        }
      });
    }

    function drawEarningsChart(data) {
      const ctx = document.getElementById('earningsChart');
      if (!ctx) return;

      if (earningsChart) earningsChart.destroy();

      earningsChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Completed', 'Cancelled', 'Pending'],
          datasets: [{
            data: [
              parseFloat(data.completed) || 0,
              parseFloat(data.cancelled) || 0,
              parseFloat(data.pending) || 0
            ],
            backgroundColor: ['#34C759', '#FF3B30', '#FF9500']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true
        }
      });
    }

    async function loadDriverProfile() {
      const token = localStorage.getItem('driver_token');
      try {
        const response = await fetch(`${API_BASE}/driver-auth/profile`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const result = await response.json();
        if (result.success) {
          const driver = result.driver || result.data;
          document.getElementById('profileName').value = driver.name || '';
          document.getElementById('profileEmail').value = driver.email || '';
          document.getElementById('profilePhone').value = driver.phone || '';
          document.getElementById('profileLicense').value = driver.license_number || '';
          document.getElementById('profileStatus').value = driver.driver_registration_status || 'pending';
        }
      } catch (error) {
        console.error('Profile error:', error);
      }
    }

    async function updateRideStatus(bookingId, newStatus) {
      // Custom confirmation modal logic
      const confirmed = await new Promise((resolve) => {
        const modal = document.getElementById('confirmationModal');
        const msg = document.getElementById('confirmMessage');
        const confirmBtn = document.getElementById('confirmOkBtn');
        const cancelBtn = document.getElementById('confirmCancelBtn');

        msg.textContent = `Are you sure you want to mark this ride as ${newStatus}?`;
        modal.style.display = 'flex';

        // Reset previous listeners
        const newConfirmBtn = confirmBtn.cloneNode(true);
        const newCancelBtn = cancelBtn.cloneNode(true);
        confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
        cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

        newConfirmBtn.addEventListener('click', () => {
          modal.style.display = 'none';
          resolve(true);
        });

        newCancelBtn.addEventListener('click', () => {
          modal.style.display = 'none';
          resolve(false);
        });
      });

      if (!confirmed) return;

      const token = localStorage.getItem('driver_token');
      try {
        const response = await fetch(`${API_BASE}/driver-stats/update-status`, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ bookingId, status: newStatus })
        });
        const result = await response.json();

        if (result.success) {
          showToast(result.message, 'success');
          loadBookings(); // Refresh list associated
          loadDashboardStats(); // Refresh counters
        } else {
          showToast(result.error || 'Failed to update status', 'error');
        }
      } catch (error) {
        console.error('Status update error:', error);
        showToast('Network error updating status', 'error');
      }
    }

    async function loadBookings() {
      const token = localStorage.getItem('driver_token');
      try {
        const response = await fetch(`${API_BASE}/driver-stats/bookings?range=${currentDateRange}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const result = await response.json();
        if (result.success) {
          const tbody = document.getElementById('bookings-table-body');
          const bookings = result.data || [];
          if (bookings.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">No bookings found</td></tr>';
            return;
          }
          tbody.innerHTML = bookings.map(b => `
            <tr>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">${new Date(b.created_at).toLocaleDateString()}</td>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">${b.customer_name || 'N/A'}</td>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">${b.pickup_location || 'N/A'} ‚Üí ${b.dropoff_location || 'N/A'}</td>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">AED ${parseFloat(b.fare_aed || 0).toFixed(2)}</td>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">
                <span style="padding: 4px 8px; border-radius: 4px; background: ${b.status === 'completed' ? '#34C759' : b.status === 'cancelled' ? '#FF3B30' : b.status === 'on_trip' ? '#007AFF' : '#FF9500'}; color: white; font-size: 12px; margin-right: 8px;">${b.status}</span>
                ${b.status === 'assigned' ? `<button onclick="updateRideStatus('${b.id}', 'on_trip')" style="padding: 4px 8px; border: none; background: #007AFF; color: white; border-radius: 4px; cursor: pointer; font-size: 12px;">Start Ride</button>` : ''}
                ${b.status === 'on_trip' ? `<button onclick="updateRideStatus('${b.id}', 'completed')" style="padding: 4px 8px; border: none; background: #34C759; color: white; border-radius: 4px; cursor: pointer; font-size: 12px;">Complete Ride</button>` : ''}
              </td>
            </tr>
          `).join('');
        }
      } catch (error) {
        console.error('Bookings error:', error);
      }
    }

    async function loadVehicle() {
      const token = localStorage.getItem('driver_token');
      try {
        const response = await fetch(`${API_BASE}/driver-stats/vehicle`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const result = await response.json();
        if (result.success && result.data) {
          const vehicle = result.data;
          document.getElementById('vehicleDetails').innerHTML = `
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
              <div><strong>üöó Model:</strong> ${vehicle.model || vehicle.vehicle_model || 'N/A'}</div>
              <div><strong>üìã Plate:</strong> ${vehicle.plate_number || vehicle.license_plate || 'N/A'}</div>
              <div><strong>üé® Color:</strong> ${vehicle.color || vehicle.vehicle_color || 'N/A'}</div>
              <div><strong>üìä Type:</strong> ${vehicle.vehicle_type || 'N/A'}</div>
              <div><strong>üë• Passengers:</strong> ${vehicle.max_passengers || vehicle.passenger_capacity || 0}</div>
              <div><strong>üß≥ Luggage:</strong> ${vehicle.max_luggage || vehicle.luggage_capacity || 0}</div>
              <div><strong>üìÖ Year:</strong> ${vehicle.year || 'N/A'}</div>
              <div><strong>‚úÖ Status:</strong> ${vehicle.status || 'active'}</div>
            </div>
          `;
        } else {
          document.getElementById('vehicleDetails').innerHTML = '<p>No vehicle assigned yet</p>';
        }
      } catch (error) {
        console.error('Vehicle error:', error);
        document.getElementById('vehicleDetails').innerHTML = '<p>Error loading vehicle</p>';
      }
    }

    async function loadEarnings() {
      const token = localStorage.getItem('driver_token');
      try {
        const response = await fetch(`${API_BASE}/driver-stats/earnings`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const result = await response.json();
        if (result.success) {
          const data = result.data;
          document.getElementById('earn-total').textContent = 'AED ' + parseFloat(data.total_earnings || 0).toFixed(2);
          document.getElementById('earn-pending').textContent = 'AED ' + parseFloat(data.pending_earnings || 0).toFixed(2);
          document.getElementById('earn-last-payout').textContent = 'AED ' + parseFloat(data.last_payout_amount || 0).toFixed(2);
          document.getElementById('earn-last-date').textContent = data.last_payout_date ? new Date(data.last_payout_date).toLocaleDateString() : 'No payout yet';

          const tbody = document.getElementById('payouts-table-body');
          const payouts = data.payouts || [];
          if (payouts.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 20px;">No payouts yet</td></tr>';
            return;
          }
          tbody.innerHTML = payouts.map(p => `
            <tr>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">${new Date(p.created_at).toLocaleDateString()}</td>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);">AED ${parseFloat(p.amount_aed || 0).toFixed(2)}</td>
              <td style="padding: 12px; border-bottom: 1px solid var(--border-color);"><span style="padding: 4px 8px; border-radius: 4px; background: ${p.status === 'completed' ? '#34C759' : '#FF9500'}; color: white; font-size: 12px;">${p.status}</span></td>
            </tr>
          `).join('');
        }
      } catch (error) {
        console.error('Earnings error:', error);
      }
    }

    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
      item.addEventListener('click', function () {
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        const page = this.getAttribute('data-page');
        document.getElementById(`page-${page}`).style.display = 'block';

        if (page === 'overview') loadDashboardStats();
        else if (page === 'bookings') loadBookings();
        else if (page === 'vehicle') loadVehicle();
        else if (page === 'earnings') loadEarnings();
        else if (page === 'profile') loadDriverProfile();
      });
    });

    // Theme
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
      const isDark = localStorage.getItem('theme') === 'dark';
      document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
    }

    checkDriverAuth();
    loadDriverProfile();
    loadDashboardStats();
  </script>
  <div id="driverToastContainer"
    style="position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px;">
  </div>

  <!-- Custom Confirmation Modal -->
  <div id="confirmationModal" class="modal-overlay" style="display: none;">
    <div class="modal-content-modern slide-in-right">
      <h3 style="margin-top: 0; color: #1a1a2e; font-size: 1.25rem;">Confirm Action</h3>
      <p id="confirmMessage" style="color: #666; margin: 15px 0 25px 0; font-size: 1rem; line-height: 1.5;">Are you
        sure?</p>
      <div class="modal-actions" style="display: flex; gap: 12px; justify-content: flex-end;">
        <button id="confirmCancelBtn" class="btn-secondary"
          style="background: #f1f2f6; color: #666; width: auto; flex: 1; max-width: 100px;">Cancel</button>
        <button id="confirmOkBtn" class="btn-primary"
          style="background: #34C759; color: white; width: auto; flex: 1; max-width: 120px; box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);">Confirm</button>
      </div>
    </div>
  </div>

  <style>
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      z-index: 10000;
      display: flex;
      justify-content: flex-end;
      /* Align right */
      align-items: flex-end;
      /* Mobile: start from bottom? or centered? User said 'fadein from right' */
      backdrop-filter: blur(4px);
    }

    /* Desktop/Standard: Side panel style for "from right" feel */
    .modal-content-modern {
      background: var(--bg-primary, white);
      width: 100%;
      max-width: 380px;
      height: 100vh;
      /* Full height side panel */
      padding: 40px 30px;
      box-shadow: -10px 0 30px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
    }

    /* Animation */
    .slide-in-right {
      animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Modern Buttons */
    .modal-actions button {
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.2s;
    }

    .modal-actions button:active {
      transform: scale(0.96);
    }

    /* Dark Mode Support */
    [data-theme="dark"] .modal-content-modern {
      background: #1e1e2d;
      color: #fff;
    }

    [data-theme="dark"] .modal-content-modern h3 {
      color: #fff !important;
    }

    [data-theme="dark"] .modal-content-modern p {
      color: #aaa !important;
    }

    [data-theme="dark"] #confirmCancelBtn {
      background: #2a2a3c !important;
      color: #ddd !important;
    }

    /* Mobile Responsive: Maybe sheet style on bottom for mobile? */
    @media (max-width: 600px) {
      .modal-overlay {
        align-items: flex-end;
      }

      .modal-content-modern {
        width: 100%;
        max-width: 100%;
        height: auto;
        border-radius: 20px 20px 0 0;
        padding: 30px 25px 40px;
        animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      }

      @keyframes slideUp {
        from {
          transform: translateY(100%);
          opacity: 0;
        }

        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
    }
  </style>
</body>

</html>

<style>
  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }

    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }

    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
</style>
</body>

<div id="driverToastContainer"
  style="position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px;">
</div>

<style>
  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }

    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }

    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
</style>

</html>